<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>8. Session Management | apache-shiro-1.2.x-reference</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.6">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../II. Core 核心/9. Cryptography 密码.html" />
    
    
    <link rel="prev" href="../II. Core 核心/7. Realms.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="2.4"
        data-chapter-title="8. Session Management"
        data-filepath="II. Core 核心/8. Session Management.md"
        data-basepath=".."
        data-revision="Tue Feb 16 2016 18:15:31 GMT+0800 (中国标准时间)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" >
            
            <span><b>1.</b> I. Overview 总览</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="I. Overview 总览/1. Introduction 介绍.html">
            
                
                    <a href="../I. Overview 总览/1. Introduction 介绍.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        1. Introduction 介绍
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="I. Overview 总览/2. Tutorial 教程.html">
            
                
                    <a href="../I. Overview 总览/2. Tutorial 教程.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        2. Tutorial 教程
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="I. Overview 总览/3. Architecture 架构.html">
            
                
                    <a href="../I. Overview 总览/3. Architecture 架构.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        3. Architecture 架构
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="I. Overview 总览/4. Configuration 配置.html">
            
                
                    <a href="../I. Overview 总览/4. Configuration 配置.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.4.</b>
                        
                        4. Configuration 配置
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" >
            
            <span><b>2.</b> II. Core 核心</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="II. Core 核心/5. Authentication 认证.html">
            
                
                    <a href="../II. Core 核心/5. Authentication 认证.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        5. Authentication 认证
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="II. Core 核心/6. Authorization 授权.html">
            
                
                    <a href="../II. Core 核心/6. Authorization 授权.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        6. Authorization 授权
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="II. Core 核心/6.1. Permissions 权限.html">
            
                
                    <a href="../II. Core 核心/6.1. Permissions 权限.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.1.</b>
                        
                        6.1. Permissions 权限
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="II. Core 核心/7. Realms.html">
            
                
                    <a href="../II. Core 核心/7. Realms.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        7. Realms
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="2.4" data-path="II. Core 核心/8. Session Management.html">
            
                
                    <a href="../II. Core 核心/8. Session Management.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.</b>
                        
                        8. Session Management
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="II. Core 核心/9. Cryptography 密码.html">
            
                
                    <a href="../II. Core 核心/9. Cryptography 密码.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.5.</b>
                        
                        9. Cryptography 密码
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" >
            
            <span><b>3.</b> III. Web Applications</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="III. Web Applications/10. Web.html">
            
                
                    <a href="../III. Web Applications/10. Web.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        10. Web
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="III. Web Applications/10.1. Configuration 配置.html">
            
                
                    <a href="../III. Web Applications/10.1. Configuration 配置.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.1.</b>
                        
                        10.1. Configuration 配置
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="III. Web Applications/10.2. urls Path based security 基于路径的安全.html">
            
                
                    <a href="../III. Web Applications/10.2. urls Path based security 基于路径的安全.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.2.</b>
                        
                        10.2. 基于路径的 url 安全
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="III. Web Applications/10.3. Default Filters 默认过滤器.html">
            
                
                    <a href="../III. Web Applications/10.3. Default Filters 默认过滤器.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.3.</b>
                        
                        10.3. Default Filters 默认过滤器
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.1.4" data-path="III. Web Applications/10.4. Session Management.html">
            
                
                    <a href="../III. Web Applications/10.4. Session Management.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.4.</b>
                        
                        10.4. Session Management
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.1.5" data-path="III. Web Applications/10.5. JSP Tag Library.html">
            
                
                    <a href="../III. Web Applications/10.5. JSP Tag Library.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.5.</b>
                        
                        10.5. JSP Tag Library
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" >
            
            <span><b>4.</b> IV. Auxiliary Support 辅助支持</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="IV. Auxiliary Support 辅助支持/11. Caching 缓存.html">
            
                
                    <a href="../IV. Auxiliary Support 辅助支持/11. Caching 缓存.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        11. Caching 缓存
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="IV. Auxiliary Support 辅助支持/12. Concurrency &amp; Multithreading 并发与多线程.html">
            
                
                    <a href="../IV. Auxiliary Support 辅助支持/12. Concurrency &amp; Multithreading 并发与多线程.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        12. Concurrency &amp; Multithreading 并发与多线程
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="IV. Auxiliary Support 辅助支持/13. Testing 测试.html">
            
                
                    <a href="../IV. Auxiliary Support 辅助支持/13. Testing 测试.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.3.</b>
                        
                        13. Testing 测试
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="IV. Auxiliary Support 辅助支持/14. Custom Subjects 自定义 Subject.html">
            
                
                    <a href="../IV. Auxiliary Support 辅助支持/14. Custom Subjects 自定义 Subject.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.4.</b>
                        
                        14. Custom Subjects 自定义 Subject
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" >
            
            <span><b>5.</b> V. Integration 整合</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="V. Integration 整合/15. Spring Framework.html">
            
                
                    <a href="../V. Integration 整合/15. Spring Framework.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        15. Spring Framework
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="V. Integration 整合/16. Guice.html">
            
                
                    <a href="../V. Integration 整合/16. Guice.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        16. Guice
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="V. Integration 整合/17. CAS.html">
            
                
                    <a href="../V. Integration 整合/17. CAS.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                        17. CAS
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" >
            
            <span><b>6.</b> VI. Tools 工具</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="VI. Tools 工具/18. Command Line Hasher.html">
            
                
                    <a href="../VI. Tools 工具/18. Command Line Hasher.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        18. Command Line Hasher
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" >
            
            <span><b>7.</b> VII. Index 目录</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1" data-path="VII. Index 目录/19. Terminology 术语.html">
            
                
                    <a href="../VII. Index 目录/19. Terminology 术语.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.1.</b>
                        
                        19. Terminology 术语
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8" >
            
            <span><b>8.</b> VIII. Other 其他</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1" data-path="VIII. Other 其他/20. 10 Minute Tutorial 十分钟教程.html">
            
                
                    <a href="../VIII. Other 其他/20. 10 Minute Tutorial 十分钟教程.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.1.</b>
                        
                        20. 10 Minute Tutorial 十分钟教程
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="VIII. Other 其他/21. Beginner&#39;s Webapp Tutorial 初学者web应用教程.html">
            
                
                    <a href="../VIII. Other 其他/21. Beginner&#39;s Webapp Tutorial 初学者web应用教程.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.2.</b>
                        
                        21. Beginner&#39;s Webapp Tutorial 初学者web应用教程
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="VIII. Other 其他/22. Application Security With Apache Shiro 用Shiro保护你的应用安全 .html">
            
                
                    <a href="../VIII. Other 其他/22. Application Security With Apache Shiro 用Shiro保护你的应用安全 .html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.3.</b>
                        
                        22. Application Security With Apache Shiro 用Shiro保护你的应用安全
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.4" data-path="VIII. Other 其他/23. CacheManager 缓存管理.html">
            
                
                    <a href="../VIII. Other 其他/23. CacheManager 缓存管理.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.4.</b>
                        
                        23. CacheManager 缓存管理
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.5" data-path="VIII. Other 其他/24. Apache Shiro Cryptography Features 加密功能.html">
            
                
                    <a href="../VIII. Other 其他/24. Apache Shiro Cryptography Features 加密功能.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.5.</b>
                        
                        24. Apache Shiro Cryptography Features 加密功能
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >apache-shiro-1.2.x-reference</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="8-session-management">8. Session Management</h1>
<p>Apache Shiro &#x63D0;&#x4F9B;&#x5B89;&#x5168;&#x6846;&#x67B6;&#x754C;&#x72EC;&#x4E00;&#x65E0;&#x4E8C;&#x7684;&#x4E1C;&#x897F;&#xFF1A;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x4F01;&#x4E1A;&#x7EA7;Session &#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x4ECE;&#x6700;&#x7B80;&#x5355;&#x7684;&#x547D;&#x4EE4;&#x884C;&#x53CA;&#x667A;&#x80FD;&#x624B;&#x673A;&#x5E94;&#x7528;&#x5230;&#x6700;&#x5927;&#x7684;&#x96C6;&#x7FA4;&#x4F01;&#x4E1A;Web &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</p>
<p>&#x8FD9;&#x5BF9;&#x8BB8;&#x591A;&#x5E94;&#x7528;&#x6709;&#x7740;&#x5F88;&#x5927;&#x7684;&#x5F71;&#x54CD;&#x2014;&#x2014;&#x76F4;&#x5230; Shiro &#x51FA;&#x73B0;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x9700;&#x8981; session &#x652F;&#x6301;&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x90E8;&#x7F72;&#x4F60;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5230; Web &#x5BB9;&#x5668;&#x6216;&#x4F7F;&#x7528;EJB &#x6709;&#x72B6;&#x6001;&#x4F1A;&#x8BDD;Bean&#x3002;Shiro &#x7684; Session &#x652F;&#x6301;&#x6BD4;&#x8FD9;&#x4E24;&#x79CD;&#x673A;&#x5236;&#x7684;&#x4F7F;&#x7528;&#x548C;&#x7BA1;&#x7406;&#x66F4;&#x4E3A;&#x7B80;&#x5355;&#xFF0C;&#x800C;&#x4E14;&#x5B83;&#x5728;&#x9002;&#x7528;&#x4E8E;&#x4EFB;&#x4F55;&#x7A0B;&#x5E8F;&#xFF0C;&#x4E0D;&#x8BBA;&#x5BB9;&#x5668;&#x3002;</p>
<p>&#x5373;&#x4F7F;&#x4F60;&#x5728;&#x4E00;&#x4E2A; Servlet &#x6216; EJB &#x5BB9;&#x5668;&#x4E2D;&#x90E8;&#x7F72;&#x4F60;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x4ECD;&#x7136;&#x6709;&#x4EE4;&#x4EBA;&#x4FE1;&#x670D;&#x7684;&#x7406;&#x7531;&#x6765;&#x4F7F;&#x7528; Shiro &#x7684;Session &#x652F;&#x6301;&#x800C;&#x4E0D;&#x662F;&#x5BB9;&#x5668;&#x7684;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E2A;
Shiro &#x7684; Session &#x652F;&#x6301;&#x7684;&#x6700;&#x53EF;&#x53D6;&#x7684;&#x529F;&#x80FD;&#x5217;&#x8868;&#xFF1A;</p>
<p>&#x7279;&#x6027;</p>
<ul>
<li><strong>POJO/J2SE based(IoC friendly)</strong> - Shiro &#x7684;&#x4E00;&#x5207;&#xFF08;&#x5305;&#x62EC;&#x6240;&#x6709;Session &#x548C;Session Management &#x65B9;&#x9762;&#xFF09;&#x90FD;&#x662F;&#x57FA;&#x4E8E;&#x63A5;&#x53E3;&#x548C;
POJO &#x5B9E;&#x73B0;&#x3002;&#x8FD9;&#x53EF;&#x4EE5;&#x8BA9;&#x4F60;&#x8F7B;&#x677E;&#x5730;&#x914D;&#x7F6E;&#x6240;&#x6709;&#x62E5;&#x6709;&#x4EFB;&#x4F55; JavaBeans &#x517C;&#x5BB9;&#x914D;&#x7F6E;&#x683C;&#x5F0F;&#xFF08;&#x5982;JSON&#xFF0C;YAML&#xFF0C;Spring XML &#x6216;&#x7C7B;
&#x4F3C;&#x7684;&#x673A;&#x5236;&#xFF09;&#x7684;&#x4F1A;&#x8BDD;&#x7EC4;&#x4EF6;&#x3002;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x8F7B;&#x677E;&#x5730;&#x6269;&#x5C55; Shiro &#x7684;&#x7EC4;&#x4EF6;&#x6216;&#x7F16;&#x5199;&#x4F60;&#x81EA;&#x5DF1;&#x6240;&#x9700;&#x7684;&#x6765;&#x5B8C;&#x5168;&#x81EA;&#x5B9A;&#x4E49; session management&#x3002;</li>
<li><strong>Easy Custom Session Storage</strong> - &#x56E0;&#x4E3A;Shiro &#x7684;Session &#x5BF9;&#x8C61;&#x662F;&#x57FA;&#x4E8E; POJO &#x7684;&#xFF0C;&#x4F1A;&#x8BDD;&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x5F88;&#x5BB9;&#x6613;&#x5730;&#x5B58;&#x50A8;&#x5728;&#x4EFB;&#x610F;&#x6570;&#x91CF;&#x7684;&#x6570;&#x636E;&#x6E90;&#x3002;&#x8FD9;&#x5141;&#x8BB8;&#x4F60;&#x81EA;&#x5B9A;&#x4E49;&#x4F60;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4F1A;&#x8BDD;&#x6570;&#x636E;&#x7684;&#x786E;&#x5207;&#x4F4D;&#x7F6E;&#x2014;&#x2014;&#x4F8B;&#x5982;&#xFF0C;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x8054;&#x7F51;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;&#xFF0C;&#x5173;&#x7CFB;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x6216;&#x4E13;&#x6709;&#x7684;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x3002;</li>
<li><strong>Container-Independent Clustering!</strong> - Shiro &#x7684;&#x4F1A;&#x8BDD;&#x53EF;&#x4EE5;&#x5F88;&#x5BB9;&#x6613;&#x5730;&#x805A;&#x96C6;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x4EFB;&#x4F55;&#x968F;&#x624B;&#x53EF;&#x7528;&#x7684;&#x7F51;&#x7EDC;&#x7F13;&#x5B58;&#x4EA7;&#x54C1;&#xFF0C;&#x50CF; Ehcache + Terracotta&#xFF0C;Coherence&#xFF0C;GigaSpaces&#xFF0C;&#x7B49;&#x7B49;&#x3002;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x4F60;&#x53EF;&#x4EE5;&#x4E3A;Shiro &#x914D;&#x7F6E;&#x4F1A;&#x8BDD;&#x7FA4;&#x96C6;&#x4E00;&#x6B21;&#x4E14;&#x4EC5;&#x4E00;&#x6B21;&#xFF0C;&#x65E0;&#x8BBA;&#x4F60;&#x90E8;&#x7F72;&#x5230;&#x4EC0;&#x4E48;&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x4F60;&#x7684;&#x4F1A;&#x8BDD;&#x5C06;&#x4EE5;&#x76F8;&#x540C;&#x7684;&#x65B9;&#x5F0F;&#x805A;&#x96C6;&#x3002;&#x4E0D;&#x9700;&#x8981;&#x5BB9;&#x5668;&#x7684;&#x5177;&#x4F53;&#x914D;&#x7F6E;&#xFF01;</li>
<li><strong>Heterogeneous Client Access</strong> - &#x4E0E; EJB &#x6216; web &#x4F1A;&#x8BDD;&#x4E0D;&#x540C;&#xFF0C;Shiro &#x4F1A;&#x8BDD;&#x53EF;&#x4EE5;&#x88AB;&#x5404;&#x79CD;&#x5BA2;&#x6237;&#x7AEF;&#x6280;&#x672F;&#x201C;&#x5171;&#x4EAB;&#x201D;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x4E00;&#x4E2A;&#x684C;&#x9762;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EF;&#x4EE5;&#x201C;&#x770B;&#x5230;&#x201D;&#x548C;&#x201C;&#x5171;&#x4EAB;&#x201D;&#x540C;&#x4E00;&#x4E2A;&#x88AB;&#x4F7F;&#x7528;&#x7684;&#x7269;&#x7406;&#x4F1A;&#x8BDD;&#x901A;&#x8FC7;&#x5728; Web &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x7684;&#x540C;&#x4E00;&#x7528;&#x6237;&#x3002;&#x6211;&#x4EEC;&#x4E0D;&#x77E5;&#x9053;&#x9664;&#x4E86; Shiro &#x4EE5;&#x5916;&#x7684;&#x5176;&#x4ED6;&#x6846;&#x67B6;&#x80FD;&#x591F;&#x652F;&#x6301;&#x8FD9;&#x4E00;&#x70B9;&#x3002;</li>
<li><strong>Event Listeners</strong> - &#x4E8B;&#x4EF6;&#x76D1;&#x542C;&#x5668;&#x5141;&#x8BB8;&#x4F60;&#x5728;&#x4F1A;&#x8BDD;&#x751F;&#x547D;&#x5468;&#x671F;&#x76D1;&#x542C;&#x751F;&#x547D;&#x5468;&#x671F;&#x4E8B;&#x4EF6;&#x3002;&#x4F60;&#x53EF;&#x4EE5;&#x4FA6;&#x542C;&#x8FD9;&#x4E9B;&#x4E8B;&#x4EF6;&#x548C;&#x5BF9;&#x81EA;&#x5B9A;&#x4E49;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x884C;&#x4E3A;&#x4F5C;&#x51FA;&#x53CD;&#x5E94;&#x2014;&#x2014;&#x4F8B;&#x5982;&#xFF0C;&#x66F4;&#x65B0;&#x7528;&#x6237;&#x8BB0;&#x5F55;&#x5F53;&#x4ED6;&#x4EEC;&#x7684;&#x4F1A;&#x8BDD;&#x8FC7;&#x671F;&#x65F6;&#x3002;</li>
<li><strong>Host Address Retention</strong> - Shiro Sessions &#x4ECE;&#x4F1A;&#x8BDD;&#x53D1;&#x8D77;&#x5730;&#x65B9;&#x4FDD;&#x7559;IP &#x5730;&#x5740;&#x6216;&#x4E3B;&#x673A;&#x540D;&#x3002;&#x8FD9;&#x5141;&#x8BB8;&#x4F60;&#x786E;&#x5B9A;&#x7528;&#x6237;&#x6240;&#x5728;&#xFF0C;&#x5E76;&#x4F5C;&#x51FA;&#x76F8;&#x5E94;&#x7684;&#x53CD;&#x5E94;&#xFF08;&#x901A;&#x5E38;&#x662F;&#x5728;IP &#x5206;&#x914D;&#x786E;&#x5B9A;&#x7684;&#x4F01;&#x4E1A;&#x5185;&#x90E8;&#x7F51;&#x7EDC;&#x73AF;&#x5883;&#xFF09;&#x3002;</li>
<li><strong>Inactivity/Expiration Support</strong> - &#x7531;&#x4E8E;&#x4E0D;&#x6D3B;&#x52A8;&#x5BFC;&#x81F4;&#x4F1A;&#x8BDD;&#x8FC7;&#x671F;&#x5982;&#x9884;&#x671F;&#x7684;&#x90A3;&#x6837;&#xFF0C;&#x4F46;&#x5B83;&#x4EEC;&#x53EF;&#x4EE5;&#x5EF6;&#x7EED;&#x5F88;&#x4E45;&#x901A;&#x8FC7; touch() &#x65B9;&#x6CD5;&#x6765;&#x4FDD;&#x6301;&#x5B83;&#x4EEC;&#x201C;&#x6D3B;&#x7740;&#x201D;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x5E0C;&#x671B;&#x7684;&#x8BDD;&#x3002;&#x8FD9;&#x5728; RIA (&#x5BCC;&#x4E92;&#x8054;&#x7F51;&#x5E94;&#x7528;)&#x73AF;&#x5883;&#x975E;&#x5E38;&#x6709;&#x7528;&#xFF0C;&#x7528;&#x6237;&#x53EF;&#x80FD;&#x4F1A;&#x4F7F;&#x7528;&#x684C;&#x9762;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x4F46;&#x53EF;&#x80FD;&#x4E0D;&#x4F1A;&#x7ECF;&#x5E38;&#x4E0E;&#x670D;&#x52A1;&#x5668;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#xFF0C;&#x4F46;&#x8BE5;&#x670D;&#x52A1;&#x5668;&#x7684;&#x4F1A;&#x8BDD;&#x4E0D;&#x5E94;&#x8FC7;&#x671F;&#x3002;</li>
<li><strong>Transparent Web Use</strong> - Shiro &#x7684;&#x7F51;&#x7EDC;&#x652F;&#x6301;&#xFF0C;&#x5145;&#x5206;&#x5730;&#x5B9E;&#x73B0;&#x548C;&#x652F;&#x6301;&#x5173;&#x4E8E;Sessions&#xFF08;HttpSession &#x63A5;&#x53E3;&#x548C;&#x5B83;&#x7684;&#x6240;&#x6709;&#x76F8;&#x5173;&#x7684;API&#xFF09;&#x7684; Servlet2.5 &#x89C4;&#x8303;.&#x8FD9;&#x610F;&#x5473;&#x7740;&#x4F60;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5728;&#x73B0;&#x6709; Web &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x4F7F;&#x7528;Shiro &#x4F1A;&#x8BDD;&#xFF0C;&#x5E76;&#x4E14;&#x4F60;&#x4E0D;&#x9700;&#x8981;&#x6539;&#x53D8;&#x4EFB;&#x4F55;&#x73B0;&#x6709;&#x7684; Web &#x4EE3;&#x7801;&#x3002;</li>
<li><strong>Can be used for SSO</strong> - &#x7531;&#x4E8E; Shiro &#x4F1A;&#x8BDD;&#x662F;&#x57FA;&#x4E8E;POJO &#x7684;&#xFF0C;&#x5B83;&#x4EEC;&#x53EF;&#x4EE5;&#x5F88;&#x5BB9;&#x6613;&#x5730;&#x5B58;&#x50A8;&#x5728;&#x4EFB;&#x4F55;&#x6570;&#x636E;&#x6E90;&#xFF0C;&#x800C;&#x4E14;&#x5B83;&#x4EEC;&#x53EF;&#x4EE5;&#x8DE8;
&#x7A0B;&#x5E8F;&#x201C;&#x5171;&#x4EAB;&#x201D;&#x5982;&#x679C;&#x9700;&#x8981;&#x7684;&#x8BDD;&#x3002;&#x6211;&#x4EEC;&#x79F0;&#x4E4B;&#x4E3A;&quot;poor man&apos;s SSO&quot;&#xFF0C;&#x5E76;&#x5B83;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x63D0;&#x4F9B;&#x7B80;&#x5355;&#x7684;&#x767B;&#x5F55;&#x4F53;&#x9A8C;&#xFF0C;&#x7531;&#x4E8E;&#x5171;&#x4EAB;&#x7684;&#x4F1A;&#x8BDD;&#x80FD;&#x591F;&#x4FDD;&#x7559;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x72B6;&#x6001;&#x3002;</li>
</ul>
<h2 id="using-sessions-&#x4F7F;&#x7528;">Using Sessions &#x4F7F;&#x7528;</h2>
<p>&#x51E0;&#x4E4E;&#x4E0E;&#x6240;&#x6709;&#x5176;&#x4ED6;&#x5728;Shiro &#x4E2D;&#x7684;&#x4E1C;&#x897F;&#x4E00;&#x6837;&#xFF0C;&#x4F60;&#x901A;&#x8FC7;&#x4E0E;&#x5F53;&#x524D;&#x6267;&#x884C;&#x7684;Subject &#x4EA4;&#x4E92;&#x6765;&#x83B7;&#x53D6;Session&#xFF1A;</p>
<pre><code>Subject currentUser = SecurityUtils.getSubject();

Session session = currentUser.getSession();
session.setAttribute( &quot;someKey&quot;, someValue);
</code></pre><p>subject.getSession() &#x65B9;&#x6CD5;&#x662F;&#x8C03;&#x7528; currentUser.getSubject(true)&#x7684;&#x5FEB;&#x6377;&#x65B9;&#x5F0F;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x90A3;&#x4E9B;&#x719F;&#x6089; HttpServletRequest API &#x7684;&#xFF0C;Subject.getSession(boolean create) &#x65B9;&#x6CD5;&#x4E0E; HttpServletRequest.getSession(boolean create) &#x65B9;&#x6CD5;&#x6709;&#x7740;&#x5F02;&#x66F2;&#x540C;&#x5DE5;&#x4E4B;&#x6548;&#x3002;</p>
<ul>
<li>&#x5982;&#x679C;&#x8BE5;Subject &#x5DF2;&#x7ECF;&#x62E5;&#x6709;&#x4E00;&#x4E2A;Session&#xFF0C;&#x5219;boolean &#x53C2;&#x6570;&#x88AB;&#x5FFD;&#x7565;&#x4E14;Session &#x88AB;&#x7ACB;&#x5373;&#x8FD4;&#x56DE;&#x3002;</li>
<li>&#x5982;&#x679C;&#x8BE5;Subject &#x8FD8;&#x6CA1;&#x6709;&#x4E00;&#x4E2A;Session &#x4E14;create &#x53C2;&#x6570;&#x4E3A;true&#xFF0C;&#x5219;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x4F1A;&#x8BDD;&#x5E76;&#x8FD4;&#x56DE;&#x8BE5;&#x4F1A;&#x8BDD;&#x3002;</li>
<li>&#x5982;&#x679C;&#x8BE5;Subject &#x8FD8;&#x6CA1;&#x6709;&#x4E00;&#x4E2A;Session &#x4E14;create &#x53C2;&#x6570;&#x4E3A;false&#xFF0C;&#x5219;&#x4E0D;&#x4F1A;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x4F1A;&#x8BDD;&#x4E14;&#x8FD4;&#x56DE;null&#x3002;</li>
</ul>
<p><em>Any Application &#x4EFB;&#x4F55;&#x5E94;&#x7528;</em></p>
<p><em>getSession &#x8981;&#x6C42;&#x80FD;&#x591F;&#x5728;&#x4EFB;&#x4F55;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5DE5;&#x4F5C;&#xFF0C;&#x751A;&#x81F3;&#x662F;&#x975E; Web &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</em></p>
<p>&#x5F53;&#x5F00;&#x53D1;&#x6846;&#x67B6;&#x4EE3;&#x7801;&#x6765;&#x786E;&#x4FDD;&#x4E00;&#x4E2A; Session &#x6CA1;&#x6709;&#x88AB;&#x521B;&#x5EFA;&#x662F;&#x6CA1;&#x6709;&#x5FC5;&#x8981;&#x7684;&#x65F6;&#x5019;&#xFF0C;subject.getSession(false) &#x53EF;&#x4EE5;&#x8D77;&#x5230;&#x5F88;&#x597D;&#x7684;&#x4F5C;&#x7528;&#x3002;
&#x5F53;&#x4F60;&#x83B7;&#x53D6;&#x4E86;&#x4E00;&#x4E2A; Subject &#x7684; Session &#x540E;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x7528;&#x5B83;&#x6765;&#x505A;&#x8BB8;&#x591A;&#x4E8B;&#x60C5;&#xFF0C;&#x50CF;&#x8BBE;&#x7F6E;&#x6216;&#x53D6;&#x5F97; attribute&#xFF0C;&#x8BBE;&#x7F6E;&#x5176;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#xFF0C;&#x4EE5;&#x53CA;
&#x66F4;&#x591A;&#x3002;&#x8BF7;&#x53C2;&#x89C1; Session &#x7684; <a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/session/Session.html" target="_blank">JavaDoc</a>&#x6765;&#x4E86;&#x89E3;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x4F1A;&#x8BDD;&#x80FD;&#x591F;&#x505A;&#x4EC0;&#x4E48;&#x3002;</p>
<h2 id="the-sessionmanager">The SessionManager</h2>
<p>SessionManager&#xFF0C;&#x540D;&#x5982;&#x5176;&#x610F;&#xFF0C;&#x5728;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x4E3A;&#x6240;&#x6709;&#x7684; subject &#x7BA1;&#x7406;Session &#x2014;&#x2014; &#x521B;&#x5EFA;&#xFF0C;&#x5220;&#x9664;&#xFF0C;inactivity(&#x5931;&#x6548;)&#x53CA;&#x9A8C;&#x8BC1;&#xFF0C;&#x7B49;&#x7B49;&#x3002;&#x5982;&#x540C;&#x5176;&#x4ED6;&#x5728;Shiro &#x4E2D;&#x7684;&#x6838;&#x5FC3;&#x7ED3;&#x6784;&#x7EC4;&#x4EF6;&#x4E00;&#x6837;&#xFF0C;SessionManager &#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x7531;
SecurityManager &#x7EF4;&#x62A4;&#x7684;&#x9876;&#x7EA7;&#x7EC4;&#x4EF6;&#x3002;</p>
<p>&#x9ED8;&#x8BA4;&#x7684; SecurityManger &#x5B9E;&#x73B0;&#x662F;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;&#x5F00;&#x7BB1;&#x5373;&#x7528;&#x7684;<a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/mgt/DefaultSecurityManager.html" target="_blank">DefaultSessionManager</a>&#x3002;DefaultSessionManager &#x7684;&#x5B9E;&#x73B0;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6240;&#x9700;&#x7684;&#x6240;&#x6709;&#x4F01;&#x4E1A;&#x7EA7;&#x4F1A;&#x8BDD;&#x7BA1;&#x7406;&#xFF0C;&#x5982; Session &#x9A8C;&#x8BC1;&#xFF0C;orphan cleanup&#xFF0C;&#x7B49;&#x7B49;&#x3002;&#x8FD9;&#x53EF;&#x4EE5;&#x5728;&#x4EFB;&#x4F55;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x4F7F;&#x7528;&#x3002;</p>
<p><em>Web Applications</em>
<em>Web &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4F7F;&#x7528;&#x4E0D;&#x540C;SessionManager &#x5B9E;&#x73B0;&#x3002;&#x8BF7;&#x53C2;&#x89C1; <a href="https://github.com/waylau/apache-shiro-1.2.x-reference/blob/master/III.%20Web%20Applications/10.%20Web.md" target="_blank">Web</a> &#x6587;&#x6863;&#x83B7;&#x53D6;web-specific Session Management &#x4FE1;&#x606F;&#x3002;</em></p>
<p>&#x50CF;&#x5176;&#x4ED6;&#x88AB; SecurityManager &#x7BA1;&#x7406;&#x7684;&#x7EC4;&#x4EF6;&#x4E00;&#x6837;&#xFF0C;SessionManager &#x53EF;&#x4EE5;&#x901A;&#x8FC7; JavaBean &#x98CE;&#x683C;&#x7684; getter/setter &#x65B9;&#x6CD5;&#x5728;&#x6240;&#x6709;Shiro
&#x9ED8;&#x8BA4; SecurityManager &#x5B9E;&#x73B0;&#xFF08;getSessionManager()/setSessionManager()&#xFF09;&#x4E0A;&#x83B7;&#x53D6;&#x6216;&#x8BBE;&#x7F6E;&#x503C;&#x3002;&#x6216;&#x8005;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x5728;&#x4F7F;&#x7528;
shiro.ini &#x914D;&#x7F6E;&#xFF1A;</p>
<pre><code>[main]
...
sessionManager = com.foo.my.SessionManagerImplementation
securityManager.sessionManager = $sessionManager
</code></pre><p>&#x4F46;&#x4ECE;&#x5934;&#x5F00;&#x59CB;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; SessionManager &#x662F;&#x4E00;&#x4E2A;&#x590D;&#x6742;&#x7684;&#x4EFB;&#x52A1;&#x4E14;&#x662F;&#x5927;&#x591A;&#x6570;&#x4EBA;&#x4E0D;&#x60F3;&#x4EB2;&#x81EA;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x3002;Shiro &#x7684;&#x5F00;&#x7BB1;&#x5373;&#x7528;&#x7684;SessionManager &#x5B9E;&#x73B0;&#x662F;&#x9AD8;&#x5EA6;&#x53EF;&#x5B9A;&#x5236;&#x7684;&#x548C;&#x53EF;&#x914D;&#x7F6E;&#x7684;&#xFF0C;&#x5E76;&#x6EE1;&#x8DB3;&#x5927;&#x591A;&#x6570;&#x7684;&#x9700;&#x8981;&#x3002;&#x672C;&#x6587;&#x6863;&#x7684;&#x5176;&#x4F59;&#x90E8;&#x5206;&#x5047;&#x5B9A;&#x4F60;&#x5C06;&#x4F7F;&#x7528; Shiro &#x7684;&#x9ED8;&#x8BA4; SessionManager &#x5B9E;&#x73B0;&#xFF0C;&#x5F53;&#x8986;&#x76D6;&#x914D;&#x7F6E;&#x9009;&#x9879;&#x65F6;&#x3002;&#x4F46;&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x4F60;&#x57FA;&#x672C;&#x4E0A;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x6216;&#x63D2;&#x5165;&#x4EFB;&#x4F55;&#x4F60;&#x60F3;&#x8981;&#x7684;&#x4E1C;&#x897F;&#x3002;</p>
<h3 id="session-timeout-&#x8D85;&#x65F6;">Session Timeout &#x8D85;&#x65F6;</h3>
<p>&#x9ED8;&#x8BA4;&#x5730;&#xFF0C;Shiro &#x7684; SessionManager &#x5B9E;&#x73B0;&#x9ED8;&#x8BA4;&#x662F; 30 &#x5206;&#x949F;&#x4F1A;&#x8BDD;&#x8D85;&#x65F6;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5982;&#x679C;&#x4EFB;&#x4F55; Session &#x521B;&#x5EFA;&#x540E;&#x95F2;&#x7F6E;&#xFF08;&#x672A;&#x88AB;&#x4F7F;&#x7528;&#xFF0C;&#x5B83;&#x7684;<a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/session/Session.html#getLastAccessTime(" target="_blank">lastAccessedTime</a>)&#x672A;&#x88AB;&#x66F4;&#x65B0;&#xFF09;&#x7684;&#x65F6;&#x95F4;&#x8D85;&#x8FC7;&#x4E86; 30 &#x5206;&#x949F;&#xFF0C;&#x90A3;&#x4E48;&#x8BE5; Session &#x5C31;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x8FC7;&#x671F;&#x7684;&#xFF0C;&#x4E14;&#x4E0D;&#x5141;&#x8BB8;&#x518D;&#x88AB;&#x4F7F;&#x7528;&#x3002;</p>
<p>&#x4F60;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E; SessionManager &#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;&#x7684; globalSessionTimeout &#x5C5E;&#x6027;&#x6765;&#x4E3A;&#x6240;&#x6709;&#x7684;&#x4F1A;&#x8BDD;&#x5B9A;&#x4E49;&#x9ED8;&#x8BA4;&#x7684;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x60F3;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x662F;&#x4E00;&#x4E2A;&#x5C0F;&#x65F6;&#x800C;&#x4E0D;&#x662F; 30 &#x5206;&#x949F;&#xFF1A;</p>
<pre><code>[main]
...
# 3,600,000 milliseconds = 1 hour
securityManager.sessionManager.globalSessionTimeout = 3600000
</code></pre><h4 id="persession-timeout">Per-Session Timeout</h4>
<p>&#x4E0A;&#x9762;&#x7684; globalSessionTimeout &#x503C;&#x9ED8;&#x8BA4;&#x662F;&#x4E3A;&#x65B0;&#x5EFA;&#x7684; Session &#x4F7F;&#x7528;&#x7684;&#x3002;&#x4F60;&#x53EF;&#x4EE5;&#x5728;&#x6BCF;&#x4E00;&#x4E2A;&#x4F1A;&#x8BDD;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x63A7;&#x5236;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x901A;&#x8FC7;&#x8BBE;&#x7F6E;&#x5355;&#x72EC;&#x7684;&#x4F1A;&#x8BDD; <a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/session/Session.html#setTimeout(long" target="_blank">timeout</a>)&#x503C;&#x3002;&#x4E0E;&#x4E0A;&#x9762;&#x7684; globalSessionTimeout &#x4E00;&#x6837;&#xFF0C;&#x8BE5;&#x503C;&#x4EE5;&#x6BEB;&#x79D2;&#xFF08;&#x4E0D;&#x662F;&#x79D2;&#xFF09;&#x4E3A;&#x65F6;&#x95F4;&#x5355;&#x4F4D;&#x3002;</p>
<h3 id="session-listeners">Session Listeners</h3>
<p>Shiro &#x652F;&#x6301; SessionListener &#x6982;&#x5FF5;&#x6765;&#x5141;&#x8BB8;&#x4F60;&#x5BF9;&#x53D1;&#x751F;&#x7684;&#x91CD;&#x8981;&#x4F1A;&#x8BDD;&#x4F5C;&#x51FA;&#x53CD;&#x5E94;&#x3002;&#x4F60;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0; <a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/session/SessionListener.html" target="_blank">SessionListener</a> &#x63A5;&#x53E3;&#xFF08;&#x6216;&#x6269;&#x5C55;&#x6613;&#x7528;&#x7684;SessionListenerAdapter &#xFF09;&#x5E76;&#x4E0E;&#x76F8;&#x5E94;&#x7684;&#x4F1A;&#x8BDD;&#x64CD;&#x4F5C;&#x4F5C;&#x51FA;&#x53CD;&#x5E94;&#x3002;
&#x7531;&#x4E8E;&#x9ED8;&#x8BA4;&#x7684; SessionManager sessionListeners &#x5C5E;&#x6027;&#x662F;&#x4E00;&#x4E2A;&#x96C6;&#x5408;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x5BF9; SessionManager &#x914D;&#x7F6E;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A; listener &#x5B9E;
&#x73B0;&#xFF0C;&#x5C31;&#x50CF;&#x5176;&#x4ED6;&#x5728; shiro.ini &#x4E2D;&#x7684;&#x96C6;&#x5408;&#x4E00;&#x6837;&#xFF1A;</p>
<pre><code>[main]
...
aSessionListener = com.foo.my.SessionListener
anotherSessionListener = com.foo.my.OtherSessionListener

securityManager.sessionManager.sessionListeners = $aSessionListener, $anotherSessionListener, etc.
</code></pre><p><em>All Session Events &#x6240;&#x6709;Session &#x4E8B;&#x4EF6;</em></p>
<p><em>&#x5F53;&#x4EFB;&#x4F55;&#x4F1A;&#x8BDD;&#x53D1;&#x751F;&#x4E8B;&#x4EF6;&#x65F6;&#xFF0C;SessionListeners &#x90FD;&#x4F1A;&#x88AB;&#x901A;&#x77E5;&#x2014;&#x2014;&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;&#x5BF9;&#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#x7684;&#x4F1A;&#x8BDD;</em></p>
<h3 id="session-storage-&#x5B58;&#x50A8;">Session Storage &#x5B58;&#x50A8;</h3>
<p>&#x6BCF;&#x5F53;&#x4E00;&#x4E2A;&#x4F1A;&#x8BDD;&#x88AB;&#x521B;&#x5EFA;&#x6216;&#x66F4;&#x65B0;&#x65F6;&#xFF0C;&#x5B83;&#x7684;&#x6570;&#x636E;&#x9700;&#x8981;&#x6301;&#x4E45;&#x5316;&#x5230;&#x4E00;&#x4E2A;&#x5B58;&#x50A8;&#x4F4D;&#x7F6E;&#x4EE5;&#x4FBF;&#x5B83;&#x80FD;&#x591F;&#x88AB;&#x7A0D;&#x540E;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8BBF;&#x95EE;&#x3002;&#x540C;&#x6837;&#x5730;&#xFF0C;&#x5F53;&#x4E00;&#x4E2A;&#x4F1A;&#x8BDD;&#x5931;&#x6548;&#x4E14;&#x4E0D;&#x518D;&#x88AB;&#x4F7F;&#x7528;&#x65F6;&#xFF0C;&#x5B83;&#x9700;&#x8981;&#x4ECE;&#x5B58;&#x50A8;&#x4E2D;&#x5220;&#x9664;&#x4EE5;&#x4FBF;&#x4F1A;&#x8BDD;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#x4E0D;&#x4F1A;&#x88AB;&#x8017;&#x5C3D;&#x3002;SessionManager &#x5B9E;&#x73B0;&#x59D4;&#x6258;&#x8FD9;&#x4E9B; Create/Read/Update/Delete(CRUD) &#x64CD;&#x4F5C;&#x4E3A;&#x5185;&#x90E8;&#x7EC4;&#x4EF6;&#xFF0C;&#x540C;&#x65F6;&#xFF0C;<a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/session/mgt/eis/SessionDAO.html" target="_blank">SessionDAO</a>&#xFF0C;&#x53CD;&#x6620;&#x4E86;&#x6570;&#x636E;&#x8BBF;&#x95EE;&#x5BF9;&#x8C61;&#xFF08;<a href="http://en.wikipedia.org/wiki/Data_access_object" target="_blank">DAO</a>&#xFF09;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x3002;</p>
<p>SessionDAO &#x7684;&#x6743;&#x529B;&#x662F;&#x4F60;&#x80FD;&#x591F;&#x5B9E;&#x73B0;&#x8BE5;&#x63A5;&#x53E3;&#x6765;&#x4E0E;&#x4F60;&#x60F3;&#x8981;&#x7684;&#x4EFB;&#x4F55;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x3002;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x4F60;&#x7684;&#x4F1A;&#x8BDD;&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x9A7B;&#x7559;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x5173;&#x7CFB;&#x6570;&#x636E;&#x5E93;&#x6216;NoSQL &#x7684;&#x6570;&#x636E;&#x5B58;&#x50A8;&#xFF0C;&#x6216;&#x5176;&#x4ED6;&#x4EFB;&#x4F55;&#x4F60;&#x9700;&#x8981;&#x7684;&#x4F4D;&#x7F6E;&#x3002;&#x4F60;&#x5F97;&#x63A7;&#x5236;&#x6301;&#x4E45;&#x6027;&#x884C;&#x4E3A;&#x3002;</p>
<p>&#x4F60;&#x53EF;&#x4EE5;&#x5C06;&#x4EFB;&#x4F55; SessionDAO &#x5B9E;&#x73B0;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;&#x914D;&#x7F6E;&#x5728;&#x9ED8;&#x8BA4;&#x7684;SessionManager &#x5B9E;&#x4F8B;&#x4E0A;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5728;shiro.ini &#x4E2D;&#xFF1A;</p>
<pre><code>[main]
...
sessionDAO = com.foo.my.SessionDAO
securityManager.sessionManager.sessionDAO = $sessionDAO
</code></pre><p>&#x7136;&#x800C;&#xFF0C;&#x6B63;&#x5982;&#x4F60;&#x53EF;&#x80FD;&#x671F;&#x671B;&#x7684;&#x90A3;&#x6837;&#xFF0C;Shiro &#x5DF2;&#x7ECF;&#x6709;&#x4E00;&#x4E9B;&#x5F88;&#x597D;&#x7684;SessionDAO &#x5B9E;&#x73B0;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x7ACB;&#x5373;&#x4F7F;&#x7528;&#x6216;&#x5B9E;&#x73B0;&#x4F60;&#x9700;&#x8981;&#x7684;&#x5B50;&#x7C7B;&#x3002;</p>
<p><em>Web Applications</em></p>
<p><em>&#x4E0A;&#x8FF0;&#x7684; securityManager.sessionManager.sessionDAO = $sessionDAO &#x4F5C;&#x4E1A;&#x4EC5;&#x5728;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x672C;&#x5730;&#x7684; Shiro &#x4F1A;&#x8BDD;&#x7BA1;&#x7406;&#x5668;&#x65F6;&#x624D;
&#x5DE5;&#x4F5C;&#x3002;Web &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x9ED8;&#x8BA4;&#x4E0D;&#x4F1A;&#x4F7F;&#x7528;&#x672C;&#x5730;&#x7684;&#x4F1A;&#x8BDD;&#x7BA1;&#x7406;&#x5668;&#xFF0C;&#x800C;&#x662F;&#x4FDD;&#x6301;&#x4E0D;&#x652F;&#x6301;SessionDAO &#x7684; Servlet Container &#x7684;&#x9ED8;&#x8BA4;&#x4F1A;&#x8BDD;
&#x7BA1;&#x7406;&#x5668;&#x3002;&#x5982;&#x679C;&#x4F60;&#x60F3;&#x57FA;&#x4E8E; Web &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x542F;&#x7528; SessionDAO &#x6765;&#x81EA;&#x5B9A;&#x4E49;&#x4F1A;&#x8BDD;&#x5B58;&#x50A8;&#x6216;&#x4F1A;&#x8BDD;&#x7FA4;&#x96C6;&#xFF0C;&#x4F60;&#x5C06;&#x4E0D;&#x5F97;&#x4E0D;&#x9996;&#x5148;&#x914D;&#x7F6E;&#x4E00;&#x4E2A;&#x672C;
&#x5730;&#x7684;Web &#x4F1A;&#x8BDD;&#x7BA1;&#x7406;&#x5668;&#x3002;&#x4F8B;&#x5982;&#xFF1A;</em></p>
<pre><code>[main]
...
sessionManager = org.apache.shiro.web.session.mgt.DefaultWebSessionManager
securityManager.sessionManager = $sessionManager

# Configure a SessionDAO and then set it:
securityManager.sessionManager.sessionDAO = $sessionDAO
</code></pre><p><em>Configure a SessionDAO! &#x914D;&#x7F6E;</em></p>
<p><em>Shiro &#x7684;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x672C;&#x5730; SessionManagers &#x4F7F;&#x7528;&#x4EC5;&#x5185;&#x5B58; Session &#x5B58;&#x50A8;&#x3002;&#x8FD9;&#x662F;&#x4E0D;&#x9002;&#x5408;&#x5927;&#x591A;&#x6570;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x3002;&#x5927;&#x591A;&#x6570;&#x751F;&#x4EA7;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x60F3;&#x8981;&#x914D;&#x7F6E;&#x63D0;&#x4F9B;&#x7684; EHCache&#xFF08;&#x89C1;&#x4E0B;&#x6587;&#xFF09;&#x652F;&#x6301;&#x6216;&#x63D0;&#x4F9B;&#x81EA;&#x5DF1;&#x7684;SessionDAO &#x5B9E;&#x73B0;&#x3002;</em></p>
<p><em>&#x8BF7;&#x6CE8;&#x610F; Web &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;&#x57FA;&#x4E8E; servlet &#x5BB9;&#x5668;&#x7684; SessionManager&#xFF0C;&#x4E14;&#x6CA1;&#x6709;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;&#x8FD9;&#x4E5F;&#x662F;&#x4F7F;&#x7528; Shiro &#x672C;&#x5730;
SessionManager &#x7684;&#x552F;&#x4E00;&#x95EE;&#x9898;&#x3002;</em></p>
<h3 id="ehcache-sessiondao">EHCache SessionDAO</h3>
<p>EHCache &#x9ED8;&#x8BA4;&#x662F;&#x6CA1;&#x6709;&#x542F;&#x7528;&#x7684;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x4F60;&#x4E0D;&#x6253;&#x7B97;&#x5B9E;&#x73B0;&#x4F60;&#x81EA;&#x5DF1;&#x7684; SessionDAO&#xFF0C;&#x90A3;&#x4E48;&#x5F3A;&#x70C8;&#x5730;&#x5EFA;&#x8BAE;&#x4F60;&#x4E3A; Shiro &#x7684; SessionManagerment &#x542F;&#x7528; EHCache &#x652F;&#x6301;&#x3002;EHCache SessionDAO &#x5C06;&#x4F1A;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x4FDD;&#x5B58;&#x4F1A;&#x8BDD;&#xFF0C;&#x5E76;&#x652F;&#x6301;&#x6EA2;&#x51FA;&#x5230;&#x78C1;&#x76D8;&#xFF0C;&#x82E5;&#x5185;&#x5B58;&#x6210;&#x4E3A;&#x5236;&#x7EA6;&#x3002;&#x8FD9;&#x5BF9;&#x751F;&#x4EA7;&#x7A0B;&#x5E8F;&#x786E;&#x4FDD;&#x4F60;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x4E0D;&#x4F1A;&#x968F;&#x673A;&#x5730;&#x201C;&#x4E22;&#x5931;&#x201D;&#x4F1A;&#x8BDD;&#x662F;&#x975E;&#x5E38;&#x597D;&#x7684;&#x3002;</p>
<p><em>Use EHCache as your default &#x8BBE;&#x7F6E; EHCache &#x4E3A;&#x9ED8;&#x8BA4;</em></p>
<p><em>&#x5982;&#x679C;&#x4F60;&#x4E0D;&#x51C6;&#x5907;&#x7F16;&#x5199;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7684; SessionDAO&#xFF0C;&#x5219;&#x660E;&#x786E;&#x5730;&#x5728;&#x4F60;&#x7684; Shiro &#x914D;&#x7F6E;&#x4E2D;&#x542F;&#x7528; EHCache&#x3002;EHCache &#x5E26;&#x6765;&#x7684;&#x597D;&#x5904;&#x8FDC;&#x4E0D;&#x6B62;&#x5728; Sessions&#xFF0C;&#x7F13;&#x5B58;&#x9A8C;&#x8BC1;&#x548C;&#x6388;&#x6743;&#x6570;&#x636E;&#x65B9;&#x9762;&#x3002;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x89C1; <a href="../IV.%20Auxiliary%20Support%20&#x8F85;&#x52A9;&#x652F;&#x6301;/11.%20Caching%20&#x7F13;&#x5B58;.md">Caching</a> &#x6587;&#x6863;&#x3002;</em></p>
<p><em>Container-Independent Session Clustering &#x72EC;&#x7ACB;&#x5BB9;&#x5668;&#x7684;Session&#x805A;&#x7C7B;</em></p>
<p>*&#x5982;&#x679C;&#x4F60;&#x6025;&#x9700;&#x72EC;&#x7ACB;&#x7684;&#x5BB9;&#x5668;&#x4F1A;&#x8BDD;&#x96C6;&#x7FA4;&#xFF0C;EHCache &#x4F1A;&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x9009;&#x62E9;&#x3002;&#x4F60;&#x53EF;&#x4EE5;&#x663E;&#x5F0F;&#x5730;&#x5728; EHCache &#x4E4B;&#x540E;&#x63D2;&#x5165;<a href="http://www.terracotta.org/" target="_blank">TerraCotta</a>&#xFF0C;&#x5E76;&#x62E5;&#x6709;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x4E8E;&#x5BB9;&#x5668;&#x96C6;&#x7FA4;&#x7684;&#x4F1A;&#x8BDD;&#x7F13;&#x5B58;&#x3002;&#x4E0D;&#x5FC5;&#x518D;&#x62C5;&#x5FC3; Tomcat&#xFF0C;JBoss&#xFF0C;Jetty&#xFF0C;WebSphere &#x6216;WebLogic &#x7279;&#x5B9A;&#x7684;&#x4F1A;&#x8BDD;&#x96C6;&#x7FA4;&#xFF01;</p>
<p>&#x4E3A;&#x4F1A;&#x8BDD;&#x542F;&#x7528; EHCache &#x662F;&#x975E;&#x5E38;&#x5BB9;&#x6613;&#x7684;&#x3002;&#x9996;&#x5148;&#xFF0C;&#x786E;&#x4FDD;&#x5728;&#x4F60;&#x7684; classpath &#x4E2D;&#x6709;shiro-ehcache-<version>.jar &#x6587;&#x4EF6;&#xFF08;&#x8BF7;&#x53C2;&#x89C1;
<a href="http://shiro.apache.org/download.html" target="_blank">Download</a> &#x9875;&#x9762;&#x6216;&#x4F7F;&#x7528; Maven &#x6216; Ant+Ivy&#xFF09;&#x3002;*</version></p>
<p>&#x5F53;&#x5728; classpath &#x4E2D;&#x540E;&#xFF0C;&#x8FD9;&#x7B2C;&#x4E00;&#x4E2A; shiro.ini &#x5B9E;&#x4F8B;&#x5411;&#x4F60;&#x6F14;&#x793A;&#x600E;&#x6837;&#x4E3A;&#x6240;&#x6709;Shiro &#x7684;&#x7F13;&#x5B58;&#x9700;&#x8981;&#xFF08;&#x4E0D;&#x53EA;&#x662F;&#x4F1A;&#x8BDD;&#x652F;&#x6301;&#xFF09;&#x4F7F;&#x7528; EHCache&#xFF1A;</p>
<pre><code>[main]

sessionDAO = org.apache.shiro.session.mgt.eis.EnterpriseCacheSessionDAO
securityManager.sessionManager.sessionDAO = $sessionDAO

cacheManager = org.apache.shiro.cache.ehcache.EhCacheManager
securityManager.cacheManager = $cacheManager
</code></pre><p>&#x6700;&#x540E;&#x4E00;&#x884C;&#xFF0C;securityManager.cacheManager = $cacheManager&#xFF0C;&#x4E3A;&#x6240;&#x6709; Shiro &#x7684;&#x9700;&#x8981;&#x914D;&#x7F6E;&#x4E86;&#x4E00;&#x4E2A; CacheManager&#x3002;&#x8BE5;CacheManager &#x5B9E;&#x4F8B;&#x4F1A;&#x81EA;&#x52A8;&#x5730;&#x76F4;&#x63A5;&#x4F20;&#x9001;&#x5230; SessionDAO&#xFF08;&#x901A;&#x8FC7; EnterpriseCacheSessionDAO &#x5B9E;&#x73B0; <a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/cache/CacheManagerAware.html" target="_blank">CacheManagerAware</a> &#x63A5;&#x53E3;&#x7684;&#x6027;&#x8D28;&#xFF09;&#x3002;</p>
<p>&#x7136;&#x540E;&#xFF0C;&#x5F53; SessionManager &#x8981;&#x6C42; EnterpriseCacheSessionDAO &#x53BB;&#x6301;&#x4E45;&#x5316;&#x4E00;&#x4E2A; Session &#x65F6;&#xFF0C;&#x5B83;&#x4F7F;&#x7528;&#x4E00;&#x4E2A; EHCache &#x652F;&#x6301;&#x7684; Cache &#x5B9E;&#x73B0;&#x53BB;&#x5B58;&#x50A8;Session &#x6570;&#x636E;&#x3002;</p>
<p><em>Web Applications</em></p>
<p><em>&#x5F53;&#x4F7F;&#x7528; Shiro &#x672C;&#x5730;&#x7684; SessionManager &#x5B9E;&#x73B0;&#x65F6;&#x4E0D;&#x8981;&#x5FD8;&#x4E86;&#x5206;&#x914D;SessionDAO &#x662F;&#x4E00;&#x9879;&#x529F;&#x80FD;&#x3002;Web &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;&#x57FA;&#x4E8E;&#x5BB9;&#x5668;&#x7684; SessionManager&#xFF0C;&#x5B83;&#x4E0D;&#x652F;&#x6301; SessionDAO&#x3002;&#x5982;&#x679C;&#x4F60;&#x60F3;&#x5728; Web &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x4F7F;&#x7528;&#x57FA;&#x4E8E; EHCache &#x7684;&#x4F1A;&#x8BDD;&#x5B58;&#x50A8;&#xFF0C;&#x914D;&#x7F6E;&#x4E00;&#x4E2A;
&#x5982;&#x4E0A;&#x6240;&#x8FF0;&#x7684; Web SessionManager&#x3002;</em></p>
<h4 id="ehcache-session-cache-configuration">EHCache Session Cache Configuration</h4>
<p>&#x9ED8;&#x8BA4;&#x5730;&#xFF0C;EhCacheManager &#x4F7F;&#x7528;&#x4E00;&#x4E2A; Shiro &#x7279;&#x5B9A;&#x7684; <a href="https://svn.apache.org/repos/asf/shiro/trunk/support/ehcache/src/main/resources/org/apache/shiro/cache/ehcache/ehcache.xml" target="_blank">ehcache.xml</a> &#x6587;&#x4EF6;&#x6765;&#x5EFA;&#x7ACB; Session &#x7F13;&#x5B58;&#x533A;&#x4EE5;&#x53CA;&#x786E;&#x4FDD; Sessions &#x6B63;&#x5E38;&#x5B58;&#x53D6;&#x7684;&#x5FC5;&#x8981;&#x8BBE;&#x7F6E;&#x3002;</p>
<p>&#x7136;&#x800C;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x60F3;&#x6539;&#x53D8;&#x7F13;&#x5B58;&#x8BBE;&#x7F6E;&#xFF0C;&#x6216;&#x60F3;&#x914D;&#x7F6E;&#x4F60;&#x81EA;&#x5DF1;&#x7684; ehcache.xml &#x6216;EHCache net.sf.ehcache.CacheManager &#x5B9E;&#x4F8B;&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x914D;&#x7F6E;&#x7F13;&#x5B58;&#x533A;&#x6765;&#x786E;&#x4FDD;Sessions &#x88AB;&#x6B63;&#x786E;&#x5730;&#x5904;&#x7406;&#x3002;</p>
<p>&#x5982;&#x679C;&#x4F60;&#x67E5;&#x770B;&#x9ED8;&#x8BA4;&#x7684; <a href="https://svn.apache.org/repos/asf/shiro/trunk/support/ehcache/src/main/resources/org/apache/shiro/cache/ehcache/ehcache.xml" target="_blank">ehcache.xml</a> &#x6587;&#x4EF6;&#xFF0C;&#x4F60;&#x4F1A;&#x770B;&#x5230;&#x63A5;&#x4E0B;&#x6765;&#x7684; shiro-activeSessionCache &#x7F13;&#x5B58;&#x914D;&#x7F6E;&#xFF1A;</p>
<pre><code>&lt;cache name=&quot;shiro-activeSessionCache&quot;
       maxElementsInMemory=&quot;10000&quot;
       overflowToDisk=&quot;true&quot;
       eternal=&quot;true&quot;
       timeToLiveSeconds=&quot;0&quot;
       timeToIdleSeconds=&quot;0&quot;
       diskPersistent=&quot;true&quot;
       diskExpiryThreadIntervalSeconds=&quot;600&quot;/&gt;
</code></pre><p>&#x5982;&#x679C;&#x4F60;&#x5E0C;&#x671B;&#x4F7F;&#x7528;&#x4F60;&#x81EA;&#x5DF1;&#x7684; ehcache.xml &#x6587;&#x4EF6;&#xFF0C;&#x90A3;&#x4E48;&#x8BF7;&#x786E;&#x4FDD;&#x4F60;&#x5DF2;&#x7ECF;&#x4E3A; Shiro &#x6240;&#x9700;&#x7684;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;&#x7C7B;&#x4F3C;&#x7684;&#x7F13;&#x5B58;&#x9879;&#x3002;&#x5F88;&#x6709;&#x53EF;&#x80FD;
&#x4F60;&#x4F1A;&#x6539;&#x53D8; maxElementsInMemory &#x7684;&#x5C5E;&#x6027;&#x503C;&#x6765;&#x543B;&#x5408;&#x4F60;&#x7684;&#x9700;&#x8981;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x81F3;&#x5C11;&#x4E0B;&#x9762;&#x4E24;&#x4E2A;&#x5B58;&#x5728;&#x4E8E;&#x4F60;&#x81EA;&#x5DF1;&#x914D;&#x7F6E;&#x4E2D;&#x7684;&#x5C5E;&#x6027;&#x662F;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#xFF1A;</p>
<ul>
<li>overflowToDisk=&quot;true&quot; - &#x8FD9;&#x786E;&#x4FDD;&#x5F53;&#x4F60;&#x6EA2;&#x51FA;&#x8FDB;&#x7A0B;&#x5185;&#x5B58;&#x65F6;&#xFF0C;&#x4F1A;&#x8BDD;&#x4E0D;&#x4E22;&#x5931;&#x4E14;&#x80FD;&#x591F;&#x88AB;&#x5E8F;&#x5217;&#x5316;&#x5230;&#x78C1;&#x76D8;&#x4E0A;&#x3002;</li>
<li>eternal=&quot;true&quot; - &#x786E;&#x4FDD;&#x7F13;&#x5B58;&#x9879;&#xFF08; Session &#x5B9E;&#x4F8B;&#xFF09;&#x6C38;&#x4E0D;&#x8FC7;&#x671F;&#x6216;&#x88AB;&#x7F13;&#x5B58;&#x81EA;&#x52A8;&#x6E05;&#x9664;&#x3002;&#x8FD9;&#x662F;&#x5F88;&#x6709;&#x5FC5;&#x8981;&#x7684;&#xFF0C;&#x56E0;&#x4E3A; Shiro &#x57FA;&#x4E8E;&#x8BA1;&#x5212;&#x8FC7;&#x7A0B;&#x5B8C;&#x6210;&#x81EA;&#x5DF1;&#x7684;&#x9A8C;&#x8BC1;&#x3002;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5173;&#x6389;&#x8FD9;&#x9879;&#xFF0C;&#x7F13;&#x5B58;&#x5C06;&#x4F1A;&#x5728; Shiro &#x4E0D;&#x77E5;&#x9053;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x6E05;&#x626B;&#x8FD9;&#x4E9B; Sessions&#xFF0C;&#x8FD9;&#x53EF;&#x80FD;&#x5F15;&#x8D77;&#x9EBB;&#x70E6;</li>
</ul>
<h4 id="ehcache-session-cache-name">EHCache Session Cache Name</h4>
<p>&#x9ED8;&#x8BA4;&#x5730;&#xFF0C;EnterpriseCacheSessionDAO &#x5411; CacheManager &#x5BFB;&#x6C42;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;&quot;shiro-activeSessionCache&quot;&#x7684; Cache&#x3002;&#x8BE5;&#x7F13;&#x5B58;&#x7684; name/region &#x5C06;&#x5728; ehcache.xml &#x4E2D;&#x914D;&#x7F6E;&#xFF0C;&#x5982;&#x4E0A;&#x6240;&#x8FF0;&#x3002;</p>
<p>&#x5982;&#x679C;&#x4F60;&#x60F3;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x540D;&#x5B57;&#x800C;&#x4E0D;&#x662F;&#x9ED8;&#x8BA4;&#x7684;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x5728;EnterpriseCacheSessionDAO &#x4E0A;&#x914D;&#x7F6E;&#x540D;&#x5B57;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p>
<pre><code>[main]
...
sessionDAO = org.apache.shiro.session.mgt.eis.EnterpriseCacheSessionDAO
sessionDAO.activeSessionsCacheName = myname
...
</code></pre><p>&#x53EA;&#x8981;&#x786E;&#x4FDD;&#x5728; ehcahe.xml &#x4E2D;&#x6709;&#x4E00;&#x9879;&#x4E0E;&#x540D;&#x5B57;&#x5339;&#x914D;&#x4E14;&#x4F60;&#x5DF2;&#x7ECF;&#x914D;&#x7F6E;&#x597D;&#x4E86;&#x5982;&#x4E0A;&#x6240;&#x8FF0;&#x7684; overflowToDisk=&quot;true&quot; &#x548C; eternal=&quot;true&quot;&#x3002;</p>
<h4 id="custom-session-ids">Custom Session IDs</h4>
<p>Shiro &#x7684; SessionDAO &#x5B9E;&#x73B0;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x5185;&#x7F6E;&#x7684; <a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/session/mgt/eis/SessionIdGenerator.html" target="_blank">SessionIdGenerator</a> &#x7EC4;&#x4EF6;&#x6765;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x65B0;&#x7684; Session ID &#x5F53;&#x6BCF;&#x6B21;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x4F1A;&#x8BDD;&#x7684;&#x65F6;&#x5019;&#x3002;&#x8BE5; ID &#x751F;&#x6210;&#x540E;&#xFF0C;&#x88AB;&#x6307;&#x6D3E;&#x7ED9;&#x65B0;&#x8FD1;&#x521B;&#x5EFA;&#x7684;Session &#x5B9E;&#x4F8B;&#xFF0C;&#x7136;&#x540E;&#x8BE5;Session &#x901A;&#x8FC7;SessionDAO &#x88AB;&#x4FDD;&#x5B58;&#x4E0B;&#x6765;&#x3002;</p>
<p>&#x9ED8;&#x8BA4;&#x7684;SessionIdGenerator &#x662F;&#x4E00;&#x4E2A; <a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/session/mgt/eis/JavaUuidSessionIdGenerator.html" target="_blank">JavaUuidSessionIdGenerator</a>&#xFF0C;&#x5B83;&#x80FD;&#x4EA7;&#x751F;&#x57FA;&#x4E8E;Java <a href="http://download.oracle.com/javase/6/docs/api/java/util/UUID.html" target="_blank">UUIDs</a> &#x7684; String IDs&#x3002;&#x8BE5;&#x5B9E;&#x73B0;&#x80FD;&#x591F;&#x652F;&#x6301;&#x6240;&#x6709;&#x7684;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x3002;</p>
<p>&#x5982;&#x679C;&#x5B83;&#x4E0D;&#x7B26;&#x5408;&#x4F60;&#x7684;&#x9700;&#x8981;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0; SessionIdGenerator &#x63A5;&#x53E3;&#x5E76;&#x5728;Shiro &#x7684; SessionDAO &#x5B9E;&#x4F8B;&#x4E0A;&#x914D;&#x7F6E;&#x8BE5;&#x5B9E;&#x73B0;&#x3002;&#x4F8B;&#x5982;&#xFF0C;
&#x5728; shiro.ini &#x4E2D;&#xFF1A;</p>
<pre><code>[main]
...
sessionIdGenerator = com.my.session.SessionIdGenerator
securityManager.sessionManager.sessionDAO.sessionIdGenerator = $sessionIdGenerator
</code></pre><h3 id="session-validation--scheduling-&#x9A8C;&#x8BC1;&#x548C;&#x8BA1;&#x5212;">Session Validation &amp; Scheduling &#x9A8C;&#x8BC1;&#x548C;&#x8BA1;&#x5212;</h3>
<p>Sessions &#x5FC5;&#x987B;&#x88AB;&#x9A8C;&#x8BC1;&#xFF0C;&#x8FD9;&#x6837;&#x4EFB;&#x4F55;&#x65E0;&#x6548;(&#x8FC7;&#x671F;&#x6216;&#x505C;&#x6B62;)&#x7684;&#x4F1A;&#x8BDD;&#x80FD;&#x591F;&#x4ECE;&#x4F1A;&#x8BDD;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x4E2D;&#x5220;&#x9664;&#x3002;&#x8FD9;&#x4FDD;&#x8BC1;&#x4E86;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x4E0D;&#x4F1A;&#x7531;&#x4E8E;&#x4E0D;&#x80FD;&#x518D;&#x6B21;&#x4F7F;&#x7528;&#x7684;&#x4F1A;&#x8BDD;&#x800C;&#x5BFC;&#x81F4;&#x5199;&#x5165;&#x8D85;&#x65F6;&#x3002;</p>
<p>&#x7531;&#x4E8E;&#x6027;&#x80FD;&#x4E0A;&#x7684;&#x539F;&#x56E0;&#xFF0C;&#x4EC5;&#x4EC5;&#x5728;Sessions &#x88AB;&#x8BBF;&#x95EE;&#xFF08;&#x4E5F;&#x5C31;&#x662F;subject.getSession()&#xFF09;&#x65F6;&#x9A8C;&#x8BC1;&#x5B83;&#x4EEC;&#x662F;&#x5426;&#x505C;&#x6B62;&#x6216;&#x8FC7;&#x671F;&#x3002;&#x8FD9;&#x610F;&#x5473;&#x7740;&#xFF0C;
&#x5982;&#x679C;&#x6CA1;&#x6709;&#x989D;&#x5916;&#x7684;&#x5B9A;&#x671F;&#x9A8C;&#x8BC1;&#xFF0C;Session orphans(&#x5B64;&#x513F;)&#x5C06;&#x4F1A;&#x5F00;&#x59CB;&#x586B;&#x5145;&#x4F1A;&#x8BDD;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x3002;</p>
<p>&#x4E00;&#x4E2A;&#x5E38;&#x89C1;&#x7684;&#x8BF4;&#x660E;&#x5B64;&#x513F;&#x7684;&#x4F8B;&#x5B50;&#x662F; Web &#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x7684;&#x573A;&#x666F;&#xFF1A;&#x6BD4;&#x65B9;&#x8BF4;&#xFF0C;&#x7528;&#x6237;&#x767B;&#x5F55;&#x5230;Web &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5E76;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x4F1A;&#x8BDD;&#x6765;&#x4FDD;&#x7559;
&#x6570;&#x636E;&#xFF08;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x72B6;&#x6001;&#xFF0C;&#x8D2D;&#x7269;&#x8F66;&#x7B49;&#xFF09;&#x3002;&#x5982;&#x679C;&#x7528;&#x6237;&#x4E0D;&#x6CE8;&#x9500;&#xFF0C;&#x5E76;&#x5728;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E0D;&#x77E5;&#x9053;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5173;&#x95ED;&#x4E86;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x5219;&#x4ED6;&#x4EEC;&#x7684;&#x4F1A;&#x8BDD;
&#x5B9E;&#x8D28;&#x4E0A;&#x662F;&#x201C;&#x8EBA;&#x5728;&#x201D;&#x4F1A;&#x8BDD;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x7684;&#xFF08;&#x5B64;&#x513F;&#xFF09;&#x3002;SessionManager &#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x68C0;&#x6D4B;&#x7528;&#x6237;&#x4E0D;&#x518D;&#x4F7F;&#x7528;&#x4ED6;&#x4EEC;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x540C;&#x65F6;&#x8BE5;&#x4F1A;&#x8BDD;&#x6C38;&#x8FDC;&#x4E0D;&#x4F1A;&#x88AB;&#x518D;&#x6B21;&#x8BBF;&#x95EE;&#xFF08;&#x5B83;&#x662F;&#x5B64;&#x513F;&#x4E86;&#xFF09;&#x3002;</p>
<p>&#x4F1A;&#x8BDD;&#x5B64;&#x513F;&#xFF0C;&#x5982;&#x679C;&#x5B83;&#x4EEC;&#x6CA1;&#x6709;&#x5B9A;&#x671F;&#x6E05;&#x9664;&#xFF0C;&#x5C06;&#x4F1A;&#x586B;&#x5145;&#x4F1A;&#x8BDD;&#x6570;&#x636E;&#x5B58;&#x50A8;&#xFF08;&#x8FD9;&#x662F;&#x5F88;&#x7CDF;&#x7CD5;&#x7684;&#xFF09;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x4E22;&#x653E;&#x5B64;&#x513F;&#xFF0C;SessionManager &#x5B9E;&#x73B0;&#x652F;&#x6301; <a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/session/mgt/SessionValidationScheduler.html" target="_blank">SessionValidationScheduler</a> &#x7684;&#x6982;&#x5FF5;&#x3002;SessionValidationScheduler &#x8D1F;&#x8D23;&#x5B9A;&#x671F;&#x5730;&#x9A8C;&#x8BC1;&#x4F1A;&#x8BDD;&#x4EE5;&#x786E;&#x4FDD;
&#x5B83;&#x4EEC;&#x662F;&#x5426;&#x9700;&#x8981;&#x6E05;&#x7406;&#x3002;</p>
<h4 id="default-sessionvalidationscheduler-&#x9ED8;&#x8BA4;">Default SessionValidationScheduler &#x9ED8;&#x8BA4;</h4>
<p>&#x9ED8;&#x8BA4;&#x53EF;&#x7528;&#x7684; SessionValidationScheduler &#x5728;&#x6240;&#x6709;&#x73AF;&#x5883;&#x4E2D;&#x90FD;&#x662F;<a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/session/mgt/ExecutorServiceSessionValidationScheduler.html" target="_blank">ExecutorServiceSessionValidationScheduler</a>&#xFF0C;&#x5B83;&#x4F7F;&#x7528; JDK
<a href="http://download.oracle.com/javase/6/docs/api/java/util/concurrent/ScheduledExecutorService.html" target="_blank">ScheduledExecutorService</a> &#x6765;&#x63A7;&#x5236;&#x9A8C;&#x8BC1;&#x9891;&#x7387;&#x3002;</p>
<p>&#x9ED8;&#x8BA4;&#x5730;&#xFF0C;&#x8BE5;&#x5B9E;&#x73B0;&#x6BCF;&#x5C0F;&#x65F6;&#x6267;&#x884C;&#x4E00;&#x6B21;&#x9A8C;&#x8BC1;&#x3002;&#x4F60;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x65B0;&#x7684; ExecutorServiceSessionValidationScheduler &#x5B9E;&#x4F8B;&#x5E76;&#x6307;
&#x5B9A;&#x4E0D;&#x540C;&#x7684;&#x95F4;&#x9694;&#xFF08;&#x4EE5;&#x6BEB;&#x79D2;&#x4E3A;&#x5355;&#x4F4D;&#xFF09;&#x6539;&#x53D8;&#x901F;&#x7387;&#x6765;&#x66F4;&#x6539;&#x9A8C;&#x8BC1;&#x9891;&#x7387;&#xFF1A;</p>
<pre><code>[main]
...
sessionValidationScheduler = org.apache.shiro.session.mgt.ExecutorServiceSessionValidationScheduler
# Default is 3,600,000 millis = 1 hour:
sessionValidationScheduler.interval = 3600000

securityManager.sessionManager.sessionValidationScheduler = $sessionValidationScheduler
</code></pre><h4 id="custom-sessionvalidationscheduler-&#x81EA;&#x5B9A;&#x4E49;">Custom SessionValidationScheduler &#x81EA;&#x5B9A;&#x4E49;</h4>
<p>&#x5982;&#x679C;&#x4F60;&#x5E0C;&#x671B;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7684; SessionValidationScheduler &#x5B9E;&#x73B0;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x5B83;&#x4F5C;&#x4E3A;&#x9ED8;&#x8BA4;&#x7684; SessionManager &#x5B9E;&#x4F8B;&#x7684;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5728;shiro.ini &#x4E2D;&#xFF1A;</p>
<pre><code>[main]
&#x2026;
sessionValidationScheduler = com.foo.my.SessionValidationScheduler
securityManager.sessionManager.sessionValidationScheduler = $sessionValidationScheduler
</code></pre><h4 id="disabling-session-validation-&#x7981;&#x7528;">Disabling Session Validation &#x7981;&#x7528;</h4>
<p>&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4F60;&#x53EF;&#x80FD;&#x5E0C;&#x671B;&#x7981;&#x7528;&#x4F1A;&#x8BDD;&#x9A8C;&#x8BC1;&#x9879;&#xFF0C;&#x7531;&#x4E8E;&#x4F60;&#x5EFA;&#x7ACB;&#x4E86;&#x4E00;&#x4E2A;&#x8D85;&#x51FA;&#x4E86;Shiro &#x63A7;&#x5236;&#x7684;&#x8FDB;&#x7A0B;&#x6765;&#x4E3A;&#x4F60;&#x6267;&#x884C;&#x9A8C;&#x8BC1;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x4E5F;&#x8BB8;&#x4F60;&#x6B63;&#x5728;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x4F01;&#x4E1A;&#x7684; Cache &#x5E76;&#x4F9D;&#x8D56;&#x4E8E;&#x7F13;&#x5B58;&#x7684;Time To Live &#x8BBE;&#x7F6E;&#x6765;&#x81EA;&#x52A8;&#x5730;&#x53BB;&#x9664;&#x65E7;&#x7684;&#x4F1A;&#x8BDD;&#x3002;&#x6216;&#x8005;&#x4E5F;&#x8BB8;&#x4F60;&#x5DF2;&#x7ECF;&#x5236;&#x5B9A;&#x4E86;&#x4E00;&#x4E2A;&#x8BA1;&#x5212;&#x4EFB;&#x52A1;&#x6765;&#x81EA;&#x52A8;&#x6E05;&#x7406;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x3002;&#x5728;&#x8FD9;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#x4F60;&#x53EF;&#x4EE5;&#x5173;&#x6389; session validation scheduling&#xFF1A;</p>
<pre><code>[main]
...
securityManager.sessionManager.sessionValidationSchedulerEnabled = false
</code></pre><p>&#x5F53;&#x4F1A;&#x8BDD;&#x4ECE;&#x4F1A;&#x8BDD;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x53D6;&#x56DE;&#x6570;&#x636E;&#x65F6;&#x5B83;&#x4ECD;&#x7136;&#x4F1A;&#x88AB;&#x9A8C;&#x8BC1;&#xFF0C;&#x4F46;&#x8FD9;&#x4F1A;&#x7981;&#x7528;&#x6389; Shiro &#x7684;&#x5B9A;&#x671F;&#x9A8C;&#x8BC1;&#x3002;</p>
<p><em>Enable Session Validation somewhere</em></p>
<p><em>&#x5982;&#x679C;&#x4F60;&#x5173;&#x95ED;&#x4E86; Shiro &#x7684;session validation scheduler&#xFF0C;&#x4F60;&#x5FC5;&#x987B;&#x901A;&#x8FC7;&#x5176;&#x4ED6;&#x7684;&#x673A;&#x5236;&#xFF08;&#x8BA1;&#x5212;&#x4EFB;&#x52A1;&#x7B49;&#xFF09;&#x6765;&#x6267;&#x884C;&#x5B9A;&#x671F;&#x7684;&#x4F1A;&#x8BDD;&#x9A8C;&#x8BC1;&#x3002;
&#x8FD9;&#x662F;&#x4FDD;&#x8BC1;&#x4F1A;&#x8BDD;&#x5B64;&#x513F;&#x4E0D;&#x4F1A;&#x586B;&#x5145;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x7684;&#x552F;&#x4E00;&#x65B9;&#x6CD5;&#x3002;</em></p>
<h4 id="invalid-session-deletion-&#x5220;&#x9664;&#x65E0;&#x6548;&#x7684;session">Invalid Session Deletion &#x5220;&#x9664;&#x65E0;&#x6548;&#x7684;Session</h4>
<p>&#x6B63;&#x5982;&#x6211;&#x4EEC;&#x4E0A;&#x9762;&#x6240;&#x8BF4;&#x7684;&#xFF0C;&#x8FDB;&#x884C;&#x5B9A;&#x671F;&#x7684;&#x4F1A;&#x8BDD;&#x9A8C;&#x8BC1;&#x4E3B;&#x8981;&#x76EE;&#x7684;&#x662F;&#x4E3A;&#x4E86;&#x5220;&#x9664;&#x4EFB;&#x4F55;&#x65E0;&#x6548;&#x7684;&#xFF08;&#x8FC7;&#x671F;&#x6216;&#x505C;&#x6B62;&#xFF09;&#x4F1A;&#x8BDD;&#x6765;&#x786E;&#x4FDD;&#x5B83;&#x4EEC;&#x4E0D;&#x4F1A;&#x5360;&#x7528;&#x4F1A;&#x8BDD;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x3002;</p>
<p>&#x9ED8;&#x8BA4;&#x5730;&#xFF0C;&#x67D0;&#x4E9B;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EF;&#x80FD;&#x4E0D;&#x5E0C;&#x671B; Shiro &#x81EA;&#x52A8;&#x5730;&#x5220;&#x9664;&#x4F1A;&#x8BDD;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5DF2;&#x7ECF;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A; SessionDAO &#x5907;&#x4EFD;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x67E5;&#x8BE2;&#xFF0C;&#x4E5F;&#x8BB8;&#x662F;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x56E2;&#x961F;&#x5E0C;&#x671B;&#x65E7;&#x7684;&#x6216;&#x65E0;&#x6548;&#x7684;&#x4F1A;&#x8BDD;&#x5728;&#x4E00;&#x5B9A;&#x7684;&#x65F6;&#x95F4;&#x5185;&#x53EF;&#x7528;&#x3002;&#x8FD9;&#x5C06;&#x5141;&#x8BB8;&#x56E2;&#x961F;&#x5BF9;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x8FD0;&#x884C;&#x67E5;&#x8BE2;&#x6765;&#x5224;&#x65AD;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x5728;&#x4E0A;&#x5468;&#x67D0;&#x4E2A;&#x7528;&#x6237;&#x521B;&#x5EFA;&#x4E86;&#x591A;&#x5C11;&#x4E2A;&#x4F1A;&#x8BDD;&#xFF0C;&#x6216;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x4F1A;&#x8BDD;&#x7684;&#x6301;&#x7EED;&#x65F6;&#x95F4;&#xFF0C;&#x6216;&#x4E0E;&#x4E4B;&#x7C7B;&#x4F3C;&#x62A5;&#x544A;&#x7C7B;&#x578B;&#x7684;&#x67E5;&#x8BE2;&#x3002;</p>
<p>&#x5728;&#x8FD9;&#x4E9B;&#x60C5;&#x5F62;&#x4E2D;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x5173;&#x95ED; invalid session deletion &#x9879;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5728;shiro.ini &#x4E2D;&#xFF1A;</p>
<pre><code>[main]
...
securityManager.sessionManager.deleteInvalidSessions = false
</code></pre><p>&#x8BF7;&#x6CE8;&#x610F;&#xFF01;&#x5982;&#x679C;&#x4F60;&#x5173;&#x95ED;&#x4E86;&#x5B83;&#xFF0C;&#x4F60;&#x5F97;&#x4E3A;&#x786E;&#x4FDD;&#x4F60;&#x7684;&#x4F1A;&#x8BDD;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x4E0D;&#x8017;&#x5C3D;&#x5B83;&#x7684;&#x7A7A;&#x95F4;&#x3002;&#x4F60;&#x5FC5;&#x987B;&#x81EA;&#x5DF1;&#x4ECE;&#x4F60;&#x7684;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x4E2D;&#x5220;&#x9664;&#x65E0;&#x6548;&#x7684;&#x4F1A;&#x8BDD;&#xFF01;</p>
<p>&#x8FD8;&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x5373;&#x4F7F;&#x4F60;&#x963B;&#x6B62;&#x4E86; Shiro &#x5220;&#x9664;&#x65E0;&#x6548;&#x7684;&#x4F1A;&#x8BDD;&#xFF0C;&#x4F60;&#x4ECD;&#x7136;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;&#x67D0;&#x79CD;&#x4F1A;&#x8BDD;&#x9A8C;&#x8BC1;&#x65B9;&#x5F0F;&#x2014;&#x2014;&#x8981;&#x6CA1;&#x901A;&#x8FC7; Shiro &#x7684;&#x73B0;&#x6709;&#x9A8C;&#x8BC1;&#x673A;&#x5236;&#xFF0C;&#x8981;&#x4E48;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x4F60;&#x81EA;&#x5DF1;&#x63D0;&#x4F9B;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x673A;&#x5236;&#xFF08;&#x89C1;&#x4E0A;&#x8FF0;&#x7684;&quot;Disabling Session Validation&quot;&#x83B7;&#x53D6;&#x66F4;&#x591A;&#xFF09;&#x3002;&#x9A8C;&#x8BC1;&#x673A;&#x5236;&#x5C06;&#x4F1A;&#x66F4;&#x65B0;&#x4F60;&#x7684;&#x4F1A;&#x8BDD;&#x8BB0;&#x5F55;&#x4EE5;&#x53CD;&#x6620;&#x65E0;&#x6548;&#x7684;&#x72B6;&#x6001;&#xFF08;&#x4F8B;&#x5982;&#xFF0C;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x5B83;&#x662F;&#x65E0;&#x6548;&#x7684;&#xFF0C;&#x5B83;&#x6700;&#x540E;&#x4E00;&#x6B21;&#x88AB;&#x8BBF;&#x95EE;&#x662F;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#xFF0C;&#x7B49;&#x7B49;&#xFF09;&#xFF0C;&#x5373;&#x4F7F;&#x4F60;&#x5728;&#x5176;&#x4ED6;&#x7684;&#x4E00;&#x4E9B;&#x65F6;&#x95F4;&#x5C06;&#x624B;&#x52A8;&#x5220;&#x9664;&#x5B83;&#x4EEC;&#x3002;</p>
<p><em>&#x5982;&#x679C;&#x4F60;&#x914D;&#x7F6E; Shiro &#x6765;&#x8BA9;&#x5B83;&#x4E0D;&#x4F1A;&#x5220;&#x9664;&#x65E0;&#x6548;&#x7684;&#x4F1A;&#x8BDD;&#xFF0C;&#x4F60;&#x5F97;&#x4E3A;&#x786E;&#x4FDD;&#x4F60;&#x7684;&#x4F1A;&#x8BDD;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x4E0D;&#x4F1A;&#x8017;&#x5C3D;&#x5B83;&#x7684;&#x7A7A;&#x95F4;&#x8D1F;&#x8D23;&#x3002;&#x4F60;&#x5FC5;&#x987B;&#x4EB2;&#x81EA;&#x4ECE;&#x4F60;&#x7684;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x5220;&#x9664;&#x65E0;&#x6548;&#x7684;&#x4F1A;&#x8BDD;&#xFF01;
&#x53E6;&#x5916;&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x7981;&#x7528;&#x4F1A;&#x8BDD;&#x5220;&#x9664;&#x5E76;&#x4E0D;&#x7B49;&#x540C;&#x4E8E;&#x7981;&#x7528; session validation schedule&#xFF08;&#x4F1A;&#x8BDD;&#x9A8C;&#x8BC1;&#x8C03;&#x5EA6;&#xFF09;&#x3002;&#x4F60;&#x5E94;&#x8BE5;&#x603B;&#x662F;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x4F1A;&#x8BDD;&#x9A8C;&#x8BC1;&#x8C03;&#x5EA6;&#x673A;&#x5236;&#x2014;&#x2014;&#x65E0;&#x8BBA;&#x662F; Shiro &#x76F4;&#x63A5;&#x652F;&#x6301;&#x6216;&#x8005;&#x662F;&#x4F60;&#x81EA;&#x5DF1;&#x7684;&#x3002;</em></p>
<h2 id="session-clustering-&#x4F1A;&#x8BDD;&#x96C6;&#x7FA4;">Session Clustering &#x4F1A;&#x8BDD;&#x96C6;&#x7FA4;</h2>
<p>Apache Shiro &#x4F1A;&#x8BDD;&#x80FD;&#x529B;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x4EE4;&#x4EBA;&#x5174;&#x594B;&#x7684;&#x4E8B;&#x60C5;&#x662F;,&#x4F60;&#x53EF;&#x4EE5;&#x539F;&#x751F;&#x7684;&#x96C6;&#x7FA4; Subject &#x4F1A;&#x8BDD;,&#x4E0D;&#x9700;&#x8981;&#x518D;&#x62C5;&#x5FC3;&#x4F60;&#x7684;&#x5BB9;&#x5668;&#x73AF;&#x5883;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;,&#x5982;&#x679C;&#x60A8;&#x4F7F;&#x7528; Shiro &#x7684;&#x539F;&#x751F;&#x4F1A;&#x8BDD;&#x5E76;&#x914D;&#x7F6E;&#x4E00;&#x4E2A;&#x4F1A;&#x8BDD;&#x96C6;&#x7FA4;,&#x53EF;&#x4EE5;,&#x8BF4;,&#x90E8;&#x7F72;&#x5230; Jetty &#x548C; Tomcat &#x5F00;&#x53D1;&#x73AF;&#x5883;,JBoss &#x6216; Geronimo &#x7684;&#x751F;&#x4EA7;&#x73AF;&#x5883;,&#x6216;&#x4EFB;&#x4F55;&#x5176;&#x4ED6;&#x73AF;&#x5883;&#xFF0C;&#x4E0D;&#x7528;&#x62C5;&#x5FC3;&#x5BB9;&#x5668;/&#x7279;&#x5B9A;&#x4E8E;&#x73AF;&#x5883;&#x7684;&#x96C6;&#x7FA4;&#x5B89;&#x88C5;&#x6216;&#x914D;&#x7F6E;&#x3002; Shiro &#x4F1A;&#x8BDD;&#x96C6;&#x7FA4;&#x914D;&#x7F6E;&#x4E00;&#x6B21;&#xFF0C;&#x65E0;&#x8BBA;&#x60A8;&#x7684;&#x90E8;&#x7F72;&#x73AF;&#x5883;&#x5982;&#x4F55;&#xFF0C;&#x90FD;&#x80FD;&#x6B63;&#x5E38;&#x8FD0;&#x884C;</p>
<p>&#x56E0;&#x4E3A; Shiro &#x7684;&#x57FA;&#x4E8E; pojo &#x7684; n &#x5C42;&#x4F53;&#x7CFB;&#x7ED3;&#x6784;,&#x4F7F;&#x4F1A;&#x8BDD;&#x96C6;&#x7FA4;&#x7684;&#x96C6;&#x7FA4;&#x673A;&#x5236;&#x975E;&#x5E38;&#x7B80;&#x5355;,&#x4F7F;&#x4F1A;&#x8BDD;&#x6301;&#x4E45;&#x6027;&#x7684;&#x6C34;&#x5E73;&#x3002; &#x4E5F;&#x5C31;&#x662F;&#x8BF4;,&#x5982;&#x679C;&#x60A8;&#x914D;&#x7F6E;&#x96C6;&#x7FA4; SessionDAO ,DAO &#x53EF;&#x4EE5;&#x4E0E;&#x96C6;&#x7FA4;&#x4EA4;&#x4E92;&#x673A;&#x5236;, Shiro &#x7684; SessionManager &#x4E0D;&#x9700;&#x8981;&#x77E5;&#x9053;&#x96C6;&#x7FA4;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<h3 id="distributed-caches-&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;">Distributed Caches &#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;</h3>
<p>&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;&#x6BD4;&#x5982; <a href="http://ehcache.org/documentation/get-started/about-distributed-cache" target="_blank">Ehcache + TerraCotta</a> , <a href="http://www.gigaspaces.com/" target="_blank">GigaSpaces</a> <a href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" target="_blank">Oracle Coherence</a> , <a href="http://memcached.org/" target="_blank">memcached</a> (&#x548C;&#x8BB8;&#x591A;&#x5176;&#x4ED6;)&#x5DF2;&#x7ECF;&#x89E3;&#x51B3; distributed-data-at-the-persistence-level(&#x5206;&#x5E03;&#x5F0F;&#x6570;&#x636E;&#x6301;&#x4E45;&#x5C42;) &#x95EE;&#x9898;&#x3002; &#x56E0;&#x6B64;&#x5728; Shiro &#x4F1A;&#x8BDD;&#x4F7F;&#x7528;&#x96C6;&#x7FA4;&#x914D;&#x7F6E;&#x5982;&#x540C;&#x4F7F;&#x7528;&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;&#x4E00;&#x6837;&#x7B80;&#x5355;&#x3002;</p>
<p>&#x8FD9;&#x4F7F;&#x60A8;&#x7684;&#x7075;&#x6D3B;&#x6027;&#x9009;&#x62E9;&#x786E;&#x5207;&#x7684;&#x96C6;&#x7FA4;&#x673A;&#x5236;,&#x9002;&#x7528;&#x4E8E;&#x4F60;&#x7684;&#x73AF;&#x5883;&#x3002;</p>
<p><em>&#x7F13;&#x5B58;</em></p>
<p><em>&#x8BF7;&#x6CE8;&#x610F;,&#x5F53;&#x542F;&#x7528;&#x5206;&#x5E03;&#x5F0F;/&#x4F01;&#x4E1A;&#x7F13;&#x5B58;&#x5728;&#x60A8;&#x7684;&#x4F1A;&#x8BDD;&#x96C6;&#x7FA4;&#x6570;&#x636E;&#x5B58;&#x50A8;,&#x4E0B;&#x5217;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#x4E4B;&#x4E00;&#x5FC5;&#x987B;&#x662F; true &#x7684;:</em></p>
<ul>
<li><p><em>&#x6574;&#x4E2A;&#x96C6;&#x7FA4;&#x8303;&#x56F4;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;&#x6709;&#x8DB3;&#x591F;&#x5185;&#x5B58;&#x6765;&#x4FDD;&#x7559;&#x6240;&#x6709;&#x7684; &#x6D3B;&#x52A8;/&#x5F53;&#x524D; &#x4F1A;&#x8BDD;</em></p>
</li>
<li><p><em>&#x5982;&#x679C;&#x6574;&#x4E2A;&#x96C6;&#x7FA4;&#x8303;&#x56F4;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;&#x6CA1;&#x6709;&#x8DB3;&#x591F;&#x7684;&#x5185;&#x5B58;&#x4FDD;&#x7559;&#x6240;&#x6709;&#x6D3B;&#x52A8;&#x4F1A;&#x8BDD;,&#x5B83;&#x5FC5;&#x987B;&#x652F;&#x6301;&#x78C1;&#x76D8;&#x6EA2;&#x51FA;,&#x4F1A;&#x8BDD;&#x662F;&#x4E0D;&#x4F1A;&#x4E22;&#x5931;&#x3002;</em></p>
</li>
</ul>
<p><em>&#x5982;&#x679C;&#x8FD9;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#x90FD;&#x5931;&#x8D25;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;&#x4F1A;&#x8BDD;&#x88AB;&#x968F;&#x673A;&#x4E22;&#x5931;,&#x5BF9;&#x4E8E;&#x7EC8;&#x7AEF;&#x7528;&#x6237;&#x6765;&#x8BF4;&#x8FD9;&#x53EF;&#x80FD;&#x4EE4;&#x4EBA;&#x6CAE;&#x4E27;&#x3002;</em></p>
<h3 id="enterprisecachesessiondao">EnterpriseCacheSessionDAO</h3>
<p>&#x5982;&#x60A8;&#x6240;&#x6599;,Shiro &#x5DF2;&#x7ECF;&#x63D0;&#x4F9B;&#x4E86; SessionDAO &#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x5C06;&#x4FDD;&#x5B58;&#x6570;&#x636E;&#x5230; &#x4F01;&#x4E1A;/&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;&#x3002; <a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/session/mgt/eis/EnterpriseCacheSessionDAO.html" target="_blank">EnterpriseCacheSessionDAO</a> &#x9884;&#x8BA1; Shiro &#x7F13;&#x5B58; &#x6216; &#x7F13;&#x5B58;&#x7BA1;&#x7406;&#x5668;&#x5DF2;&#x7ECF;&#x914D;&#x7F6E;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x7F13;&#x5B58;&#x673A;&#x5236;&#x3002;</p>
<p>&#x4F8B;&#x5982;,&#x5728; shiro.ini :</p>
<pre><code>#This implementation would use your preferred distributed caching product&apos;s APIs:
activeSessionsCache = my.org.apache.shiro.cache.CacheImplementation

sessionDAO = org.apache.shiro.session.mgt.eis.EnterpriseCacheSessionDAO
sessionDAO.activeSessionsCache = $activeSessionsCache

securityManager.sessionManager.sessionDAO = $sessionDAO
</code></pre><p>&#x867D;&#x7136;&#x4F60;&#x53EF;&#x4EE5;&#x5C06;&#x7F13;&#x5B58;&#x5B9E;&#x4F8B;&#x76F4;&#x63A5;&#x6CE8;&#x5165;&#x5230; SessionDAO &#x5982;&#x4E0A;&#x6240;&#x793A;,&#x5B83;&#x901A;&#x5E38;&#x662F;&#x66F4;&#x5E38;&#x89C1;&#x7684;&#x914D;&#x7F6E;&#x4E00;&#x822C;&#x662F;&#x7F13;&#x5B58;&#x7BA1;&#x7406;&#x5668; &#x4F7F;&#x7528; Shiro &#x7684;&#x6240;&#x6709;&#x7F13;&#x5B58;&#x7684;&#x9700;&#x6C42;(&#x4F1A;&#x8BDD;&#x4EE5;&#x53CA;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x548C;&#x6388;&#x6743;&#x6570;&#x636E;)&#x3002; &#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;,&#x800C;&#x4E0D;&#x662F; &#x76F4;&#x63A5;&#x914D;&#x7F6E; &#x7F13;&#x5B58;&#x5B9E;&#x4F8B;,&#x60A8;&#x4F1A;&#x544A;&#x8BC9; EnterpriseCacheSessionDAO &#x7F13;&#x5B58;&#x7BA1;&#x7406;&#x5668; &#x4E2D;&#x7684;&#x7F13;&#x5B58;&#x7684;&#x540D;&#x79F0;&#xFF0C;&#x5E94;&#x8BE5;&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x6D3B;&#x52A8;&#x4F1A;&#x8BDD;&#x3002;
&#x4F8B;&#x5982;:</p>
<pre><code># This implementation would use your caching product&apos;s APIs:
cacheManager = my.org.apache.shiro.cache.CacheManagerImplementation

# Now configure the EnterpriseCacheSessionDAO and tell it what
# cache in the CacheManager should be used to store active sessions:
sessionDAO = org.apache.shiro.session.mgt.eis.EnterpriseCacheSessionDAO
# This is the default value.  Change it if your CacheManager configured a different name:
sessionDAO.activeSessionsCacheName = shiro-activeSessionsCache
# Now have the native SessionManager use that DAO:
securityManager.sessionManager.sessionDAO = $sessionDAO

# Configure the above CacheManager on Shiro&apos;s SecurityManager
# to use it for all of Shiro&apos;s caching needs:
securityManager.cacheManager = $cacheManager
</code></pre><p>&#x4F46;&#x662F;&#x4E0A;&#x9762;&#x7684;&#x914D;&#x7F6E;&#x6709;&#x4E00;&#x4E9B;&#x6709;&#x70B9;&#x5947;&#x602A;&#x3002; &#x4F60;&#x6CE8;&#x610F;&#x5230;&#x5417;?</p>
<p>&#x6709;&#x8DA3;&#x7684;&#x5173;&#x4E8E;&#x8FD9;&#x4E2A;&#x914D;&#x7F6E;,&#x5728;&#x914D;&#x7F6E;&#x6211;&#x4EEC;&#x5B9E;&#x9645;&#x4E0A;&#x544A;&#x8BC9; SessionDAO &#x5B9E;&#x4F8B;&#x4F7F;&#x7528;&#x4E00;&#x4E2A; &#x7F13;&#x5B58; &#x6216; &#x7F13;&#x5B58;&#x7BA1;&#x7406;&#x5668; ! &#x6240;&#x4EE5;&#x5982;&#x4F55; SessionDAO &#x4F7F;&#x7528;&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;&#x5417;?</p>
<p>&#x5F53; Shiro &#x521D;&#x59CB;&#x5316; SecurityManager ,&#x5B83;&#x5C06;&#x68C0;&#x67E5;&#x770B;&#x770B; SessionDAO &#x662F;&#x5426; &#x5B9E;&#x73B0;&#x4E86; <a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/cache/CacheManagerAware.html" target="_blank">CacheManagerAware</a> &#x63A5;&#x53E3;&#x3002; &#x5982;&#x679C;&#x662F;&#x8FD9;&#x6837;,&#x5B83;&#x5C06;&#x81EA;&#x52A8;&#x63D0;&#x4F9B;&#x4EFB;&#x4F55;&#x53EF;&#x7528;&#x7684;&#x5168;&#x5C40;&#x914D;&#x7F6E; &#x7F13;&#x5B58;&#x7BA1;&#x7406;&#x5668; &#x3002;</p>
<p>&#x6240;&#x4EE5;,&#x5F53; Shiro &#x8BC4;&#x4F30; securityManager.cacheManager = $cacheManager  &#x884C;,&#x5B83;&#x5C31;&#x4F1A;&#x53D1;&#x73B0; EnterpriseCacheSessionDAO &#x5B9E;&#x73B0;&#x4E86; CacheManagerAware &#x63A5;&#x53E3;&#x548C;&#x8C03;&#x7528; setCacheManager &#x548C;&#x4F60;&#x7684;&#x914D;&#x7F6E;&#x65B9;&#x6CD5; &#x7F13;&#x5B58;&#x7BA1;&#x7406;&#x5668; &#x4F5C;&#x4E3A;&#x65B9;&#x6CD5;&#x7684;&#x53C2;&#x6570;&#x3002;</p>
<p>&#x7136;&#x540E;&#x5728;&#x8FD0;&#x884C;&#x65F6;,&#x5F53; EnterpriseCacheSessionDAO &#x9700;&#x8981; activeSessionsCache &#x5B83;&#x4F1A;&#x95EE; &#x7F13;&#x5B58;&#x7BA1;&#x7406;&#x5668; &#x4F7F;&#x7528;&#x5B9E;&#x4F8B;&#x8FD4;&#x56DE;&#x5B83; activeSessionsCacheName &#x4F5C;&#x4E3A;&#x67E5;&#x627E;&#x5F97;&#x5230;&#x7684;&#x5173;&#x952E; &#x7F13;&#x5B58; &#x5B9E;&#x4F8B;&#x3002; &#x90A3; &#x7F13;&#x5B58; &#x5B9E;&#x4F8B;(&#x652F;&#x6301;&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;/&#x4F01;&#x4E1A;&#x4EA7;&#x54C1;&#x7684;API)&#x5C06;&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x548C;&#x68C0;&#x7D22;&#x4F1A;&#x8BDD;&#x7684;&#x6240;&#x6709; SessionDAO CRUD &#x64CD;&#x4F5C;&#x3002;</p>
<h3 id="ehcache--terracotta">Ehcache + Terracotta</h3>
<p>&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;&#x89E3;&#x51B3;&#x65B9;&#x6848;,&#x4EBA;&#x4EEC;&#x53D6;&#x5F97;&#x4E86;&#x6210;&#x529F;&#x5728;&#x4F7F;&#x7528; Shiro &#x7684;Ehcache + Terracotta &#x914D;&#x5BF9;&#x3002; &#x770B;&#x5230; Ehcache-hosted <a href="http://ehcache.org/documentation/get-started/about-distributed-cache" target="_blank">&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;&#x4E0E;Terracotta </a>&#x6587;&#x6863;&#x7684;&#x5168;&#x90E8;&#x7EC6;&#x8282;&#x548C; Ehcache &#x5982;&#x4F55;&#x542F;&#x7528;&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;&#x3002;</p>
<p>&#x4E00;&#x65E6;&#x4F60;&#x5F97;&#x5230; Terracotta &#x96C6;&#x7FA4;&#x5904;&#x7406; Ehcache ,Shiro-specific &#x90E8;&#x5206;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x3002; &#x9605;&#x8BFB;&#x5E76;&#x9075;&#x5B88; EHCache SessionDAO &#x6587;&#x6863;,&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x505A;&#x51FA;&#x4E00;&#x4E9B;&#x6539;&#x53D8;</p>
<p>Ehcache &#x4F1A;&#x8BDD;&#x7F13;&#x5B58;&#x914D;&#x7F6E; &#x5F15;&#x7528;&#x4E4B;&#x524D; &#x4E0D;&#x5DE5;&#x4F5C; &#x2014;&#x2014; Terracotta &#x7279;&#x5B9A;&#x7684;&#x914D;&#x7F6E;&#x662F;&#x5FC5;&#x8981;&#x7684;&#x3002; &#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E2A;&#x793A;&#x4F8B;&#x914D;&#x7F6E;,&#x6D4B;&#x8BD5;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#x3002; &#x5176;&#x5185;&#x5BB9;&#x4FDD;&#x5B58;&#x5728;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x5E76;&#x5C06;&#x5176;&#x4FDD;&#x5B58;&#x5728;&#x4E00;&#x4E2A; ehcache.xml &#x6587;&#x4EF6;:</p>
<pre><code>&lt;ehcache&gt;
    &lt;terracottaConfig url=&quot;localhost:9510&quot;/&gt;
    &lt;diskStore path=&quot;java.io.tmpdir/shiro-ehcache&quot;/&gt;
    &lt;defaultCache
        maxElementsInMemory=&quot;10000&quot;
        eternal=&quot;false&quot;
        timeToIdleSeconds=&quot;120&quot;
        timeToLiveSeconds=&quot;120&quot;
        overflowToDisk=&quot;false&quot;
        diskPersistent=&quot;false&quot;
        diskExpiryThreadIntervalSeconds=&quot;120&quot;&gt;
        &lt;terracotta/&gt;
   &lt;/defaultCache&gt;
   &lt;cache name=&quot;shiro-activeSessionCache&quot;
       maxElementsInMemory=&quot;10000&quot;
       eternal=&quot;true&quot;
       timeToLiveSeconds=&quot;0&quot;
       timeToIdleSeconds=&quot;0&quot;
       diskPersistent=&quot;false&quot;
       overflowToDisk=&quot;false&quot;
       diskExpiryThreadIntervalSeconds=&quot;600&quot;&gt;
       &lt;terracotta/&gt;
   &lt;/cache&gt;
   &lt;!-- Add more cache entries as desired, for example,
        Realm authc/authz caching: --&gt;
&lt;/ehcache&gt;
</code></pre><p>&#x5F53;&#x7136;&#x4F60;&#x60F3;&#x8981;&#x6539;&#x53D8;&#x4F60; <terracottaConfig url="localhost:9510"> e &#x6761;&#x76EE;&#x5F15;&#x7528;&#x9002;&#x5F53;&#x7684;&#x4E3B;&#x673A;/&#x7AEF;&#x53E3; Terracotta &#x670D;&#x52A1;&#x5668;&#x9635;&#x5217;&#x3002; &#x8FD8;&#x8981;&#x6CE8;&#x610F;,&#x4E0E; &#x4EE5;&#x524D;&#x7684; &#x914D;&#x7F6E;&#x4E2D;, ehcache-activeSessionCache &#x5143;&#x7D20;&#x4E0D;&#x8BBE;&#x7F6E; diskPersistent &#x6216; overflowToDisk &#x5C5E;&#x6027;&#x4E3A; true &#x7684;&#x3002;&#x4ED6;&#x4EEC;&#x90FD;&#x5E94;&#x8BE5;&#x662F; &#x5047; &#x4F5C;&#x4E3A;&#x771F;&#x5B9E;&#x503C;&#x4E0D;&#x652F;&#x6301;&#x5728;&#x96C6;&#x7FA4;&#x914D;&#x7F6E;&#x3002;</terracottaConfig></p>
<p>&#x5728;&#x4F60;&#x4FDD;&#x5B58;&#x4E86; ehcache.xml &#x6587;&#x4EF6;,&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728; Shiro &#x7684;&#x914D;&#x7F6E;&#x4E2D;&#x5F15;&#x7528;&#x5B83;&#x3002; &#x5047;&#x8BBE;&#x4F60;&#x5DF2;&#x7ECF;&#x4F5C;&#x4E86; terracotta &#x7279;&#x5B9A; ehcache.xml &#x6587;&#x4EF6;&#x5728;&#x7C7B;&#x8DEF;&#x5F84;&#x7684;&#x6839;,&#x8FD9;&#x662F;&#x6700;&#x540E;&#x7684; Shiro &#x914D;&#x7F6E;,&#x4F7F; Terracotta + Ehcache &#x96C6;&#x7FA4;&#x7684; Shiro &#x7684;&#x9700;&#x8981;(&#x5305;&#x62EC;&#x4F1A;&#x8BDD;):</p>
<pre><code>sessionDAO = org.apache.shiro.session.mgt.eis.EnterpriseCacheSessionDAO
# This name matches a cache name in ehcache.xml:
sessionDAO.activeSessionsCacheName = shiro-activeSessionsCache
securityManager.sessionManager.sessionDAO = $sessionDAO

# Configure The EhCacheManager:
cacheManager = org.apache.shiro.cache.ehcache.EhCacheManager
cacheManager.cacheManagerConfigFile = classpath:ehcache.xml

# Configure the above CacheManager on Shiro&apos;s SecurityManager
# to use it for all of Shiro&apos;s caching needs:
securityManager.cacheManager = $cacheManager
</code></pre><p>&#x8BF7;&#x8BB0;&#x4F4F;, &#x987A;&#x5E8F;&#x5F88;&#x91CD;&#x8981; &#x3002; &#x901A;&#x8FC7;&#x914D;&#x7F6E; &#x7F13;&#x5B58;&#x7BA1;&#x7406;&#x5668; &#x5728; SecurityManager &#x6700;&#x540E;,&#x6211;&#x4EEC;&#x786E;&#x4FDD;&#x53EF;&#x4EE5;&#x4F20;&#x64AD;&#x5230;&#x6240;&#x6709;&#x4E4B;&#x524D;&#x914D;&#x7F6E;&#x7F13;&#x5B58;&#x7BA1;&#x7406;&#x5668; CacheManagerAware &#x7EC4;&#x4EF6;(&#x5982; EnterpriseCachingSessionDAO )&#x3002;</p>
<h3 id="zookeeper">Zookeeper</h3>
<p>&#x7528;&#x6237;&#x62A5;&#x544A;&#x4F7F;&#x7528;  <a href="http://zookeeper.apache.org/" target="_blank">Apache Zookeeper</a> &#x6765;&#x7BA1;&#x7406;/&#x534F;&#x8C03;&#x5206;&#x5E03;&#x5F0F;&#x4F1A;&#x8BDD;&#x3002; &#x5982;&#x679C;&#x4F60;&#x6709;&#x4EFB;&#x4F55;&#x6587;&#x6863;/&#x8BC4;&#x8BBA;&#x5173;&#x4E8E;&#x8FD9;&#x4E2A;&#x5DE5;&#x4F5C;,&#x8BF7;&#x63D0;&#x4EA4;&#x5230;&#x5230; <a href="http://shiro.apache.org/mailing-lists.html" target="_blank">Shiro &#x90AE;&#x4EF6;&#x5217;&#x8868;</a></p>
<h2 id="sessions-and-subject-state-&#x72B6;&#x6001;">Sessions and Subject State &#x72B6;&#x6001;</h2>
<h3 id="stateful-applications-sessions-allowed-&#x6709;&#x72B6;&#x6001;">Stateful Applications (Sessions allowed) &#x6709;&#x72B6;&#x6001;</h3>
<p>&#x9ED8;&#x8BA4;&#x5730;&#xFF0C;Shiro &#x7684;SecurityManager &#x5B9E;&#x73B0;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;Subject &#x7684;Session &#x4F5C;&#x4E3A;&#x4E00;&#x79CD;&#x7B56;&#x7565;&#x6765;&#x4E3A;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x5F15;&#x7528;&#x5B58;&#x50A8;Subject &#x7684;&#x8EAB;&#x4EFD; ID&#xFF08;PrincipalCollection&#xFF09;&#x548C;&#x9A8C;&#x8BC1;&#x72B6;&#x6001;&#xFF08;subject.isAuthenticated()&#xFF09;&#x3002;&#x8FD9;&#x901A;&#x5E38;&#x53D1;&#x751F;&#x5728;&#x4E00;&#x4E2A;Subject &#x767B;&#x5F55;&#x540E;&#x6216;&#x5F53;&#x4E00;&#x4E2A; Subject
&#x7684;&#x8EAB;&#x4EFD; ID &#x901A;&#x8FC7;Remember &#x670D;&#x52A1;&#x88AB;&#x53D1;&#x73B0;&#x540E;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x9ED8;&#x8BA4;&#x7684;&#x65B9;&#x6CD5;&#x6709;&#x51E0;&#x4E2A;&#x597D;&#x5904;:</p>
<ul>
<li><p>&#x4EFB;&#x4F55;&#x670D;&#x52A1;&#x4E8E;&#x8BF7;&#x6C42;&#xFF0C;&#x8C03;&#x7528;&#x6216;&#x6D88;&#x606F;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EF;&#x4EE5;&#x7528;&#x8BF7;&#x6C42;/&#x8C03;&#x7528;/&#x6D88;&#x606F;&#x7684;&#x6709;&#x6548;&#x8F7D;&#x8377;&#x5173;&#x8054;&#x4F1A;&#x8BDD;ID&#xFF0C;&#x4E14;&#x8FD9;&#x662F;Shiro &#x7528;&#x5165;&#x7AD9;
&#x8BF7;&#x6C42;&#x5173;&#x8054;&#x7528;&#x6237;&#x6240;&#x6709;&#x6240;&#x5FC5;&#x987B;&#x7684;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x4F7F;&#x7528;Subject.Builder&#xFF0C;&#x8FD9;&#x662F;&#x9700;&#x8981;&#x83B7;&#x53D6;&#x76F8;&#x5173;&#x7684;Subject &#x6240;&#x9700;&#x7684;&#x4E00;&#x5207;&#xFF1A;</p>
<p>  Serializable sessionId = //get from the inbound request or remote method invocation payload
  Subject requestSubject = new Subject.Builder().sessionId(sessionId).buildSubject();</p>
</li>
</ul>
<p>&#x8FD9;&#x7ED9;&#x5927;&#x591A;&#x6570;Web &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53CA;&#x4EFB;&#x4F55;&#x7F16;&#x5199;&#x8FDC;&#x7A0B;&#x5904;&#x7406;&#x6216;&#x6D88;&#x606F;&#x6846;&#x67B6;&#x7684;&#x4EBA;&#x5E26;&#x6765;&#x4E86;&#x4EE4;&#x4EBA;&#x96BE;&#x4EE5;&#x7F6E;&#x4FE1;&#x7684;&#x65B9;&#x4FBF;&#xFF08;&#x8FD9;&#x4E8B;&#x5B9E;&#x4E0A;&#x662F;Shiro
&#x7684;Web &#x652F;&#x6301;&#x5728;&#x81EA;&#x5DF1;&#x7684;&#x6846;&#x67B6;&#x4EE3;&#x7801;&#x5185;&#x5173;&#x8054;Subject &#x548C;ServletRequest&#xFF09;&#x3002;</p>
<ul>
<li>&#x4EFB;&#x4F55;&quot;RememberMe&quot;&#x8EAB;&#x4EFD;&#x57FA;&#x4E8E;&#x4E00;&#x4E2A;&#x80FD;&#x591F;&#x5728;&#x7B2C;&#x4E00;&#x6B21;&#x8BBF;&#x95EE;&#x5C31;&#x80FD;&#x6301;&#x4E45;&#x5316;&#x5230;&#x4F1A;&#x8BDD;&#x7684;&#x521D;&#x59CB;&#x8BF7;&#x6C42;&#x3002;&#x8FD9;&#x786E;&#x4FDD;&#x4E86;Subject &#x88AB;&#x8BB0;&#x4F4F;&#x7684;&#x8EAB;&#x4EFD;&#x53EF;&#x4EE5;&#x8DE8;&#x8BF7;&#x6C42;&#x4FDD;&#x5B58;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x53CA;&#x5C06;&#x5B83;&#x89E3;&#x91CA;&#x5230;&#x6BCF;&#x4E2A;&#x8BF7;&#x6C42;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5728;&#x4E00;&#x4E2A; Web &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#xFF0C;&#x6CA1;&#x6709;&#x5FC5;&#x8981;&#x53BB;&#x8BFB;&#x53D6;&#x6BCF;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x7684;&#x52A0;&#x5BC6;RememberMe Cookie&#xFF0C;&#x5982;&#x679C;&#x8BE5;&#x8EAB;&#x4EFD;&#x5728;&#x4F1A;&#x8BDD;&#x4E2D;&#x662F;&#x5DF2;&#x77E5;&#x7684;&#x3002;&#x8FD9;&#x53EF;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x597D;&#x7684;&#x6027;&#x80FD;&#x63D0;&#x5347;&#x3002;</li>
</ul>
<h3 id="stateless-applications-sessionless-&#x65E0;&#x72B6;&#x6001;">Stateless Applications (Sessionless) &#x65E0;&#x72B6;&#x6001;</h3>
<p>&#x867D;&#x7136;&#x4E0A;&#x8FF0;&#x7684;&#x9ED8;&#x8BA4;&#x7B56;&#x7565;&#x5BF9;&#x4E8E;&#x5927;&#x591A;&#x6570;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x800C;&#x8A00;&#x662F;&#x5F88;&#x597D;&#x7684;&#xFF08;&#x901A;&#x5E38;&#x662F;&#x53EF;&#x53D6;&#x7684;&#xFF09;&#xFF0C;&#x4F46;&#x8FD9;&#x5BF9;&#x4E8E;&#x5C1D;&#x8BD5;&#x5C3D;&#x53EF;&#x80FD;&#x65E0;&#x72B6;&#x6001;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6765;&#x8BF4;&#x662F;&#x4E0D;&#x5408;&#x9002;&#x7684;&#x3002;&#x8BB8;&#x591A;&#x65E0;&#x72B6;&#x6001;&#x7684;&#x67B6;&#x6784;&#x89C4;&#x5B9A;&#x5728;&#x8BF7;&#x6C42;&#x4E2D;&#x4E0D;&#x80FD;&#x5B58;&#x5728;&#x6301;&#x4E45;&#x72B6;&#x6001;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x7684; Sessions &#x4E0D;&#x4F1A;&#x88AB;&#x5141;&#x8BB8;&#xFF08;&#x4E00;&#x4E2A;&#x4F1A;&#x8BDD;&#x5176;&#x672C;&#x8D28;&#x4EE3;&#x8868;&#x4E86;&#x6301;&#x4E45;&#x72B6;&#x6001;&#xFF09;&#x3002;</p>
<p>&#x4F46;&#x8FD9;&#x4E00;&#x8981;&#x6C42;&#x5E26;&#x6765;&#x4E00;&#x4E2A;&#x4FBF;&#x5229;&#x7684;&#x4EE3;&#x4EF7;&#x2014;&#x2014; Subject &#x72B6;&#x6001;&#x4E0D;&#x80FD;&#x8DE8;&#x8BF7;&#x6C42;&#x4FDD;&#x7559;&#x3002;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x6709;&#x8FD9;&#x4E00;&#x8981;&#x6C42;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5FC5;&#x987B;&#x786E;&#x4FDD; Subject &#x72B6;&#x6001;&#x53EF;&#x4EE5;&#x5728;&#x6BCF;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x4E2D;&#x4EE5;&#x5176;&#x4ED6;&#x7684;&#x65B9;&#x5F0F;&#x4EE3;&#x8868;&#x3002;</p>
<p>&#x8FD9;&#x51E0;&#x4E4E;&#x603B;&#x662F;&#x901A;&#x8FC7;&#x9A8C;&#x8BC1;&#x6BCF;&#x4E2A;&#x7531;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5904;&#x7406;&#x7684;&#x8BF7;&#x6C42;/&#x8C03;&#x7528;/&#x6D88;&#x606F;&#x6765;&#x5B8C;&#x6210;&#x7684;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5927;&#x591A;&#x6570;&#x65E0;&#x72B6;&#x6001; Web &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x901A;&#x5E38;&#x652F;&#x6301;&#x8FD9;&#x4E00;&#x70B9;&#x901A;&#x8FC7;&#x6267;&#x884C; HTTP &#x57FA;&#x672C;&#x9A8C;&#x8BC1;&#xFF0C;&#x5141;&#x8BB8;&#x6D4F;&#x89C8;&#x5668;&#x9A8C;&#x8BC1;&#x6BCF;&#x4E00;&#x4E2A;&#x4EE3;&#x8868;&#x6700;&#x7EC8;&#x7528;&#x6237;&#x7684;&#x8BF7;&#x6C42;</p>
<h4 id="disabling-subject-state-session-storage-&#x7981;&#x7528;-subject-&#x72B6;&#x6001;&#x4F1A;&#x8BDD;&#x5B58;&#x50A8;">Disabling Subject State Session Storage &#x7981;&#x7528; Subject &#x72B6;&#x6001;&#x4F1A;&#x8BDD;&#x5B58;&#x50A8;</h4>
<p>&#x5728; Shiro 1.2 &#x53CA;&#x4EE5;&#x540E;&#x5F00;&#x59CB;&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x60F3;&#x7981;&#x7528; Shiro &#x7684;&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#x7B56;&#x7565;&#x2014;&#x2014;&#x5C06;Subject &#x72B6;&#x6001;&#x6301;&#x4E45;&#x5316;&#x5230;&#x4F1A;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x7981;&#x7528;&#x6240;&#x6709; Subject &#x7684;&#x8FD9;&#x4E00;&#x9879;&#xFF0C;&#x901A;&#x8FC7;&#x4E0B;&#x9762;&#x7684;&#x64CD;&#x4F5C;&#xFF1A;</p>
<p>&#x5728;shiro.ini &#x4E2D;&#xFF0C;&#x5728; securityManager &#x4E0A;&#x914D;&#x7F6E;&#x4E0B;&#x9762;&#x7684;&#x5C5E;&#x6027;&#xFF1A;</p>
<pre><code>[main]
...
securityManager.subjectDAO.sessionStorageEvaluator.sessionStorageEnabled = false
...
</code></pre><p>&#x8FD9;&#x5C06;&#x9632;&#x6B62; Shiro &#x4F7F;&#x7528; Subject &#x7684;&#x4F1A;&#x8BDD;&#x6765;&#x5B58;&#x50A8;&#x6240;&#x6709;&#x8DE8;&#x8BF7;&#x6C42;/&#x8C03;&#x7528;/&#x6D88;&#x606F;&#x7684;Subject &#x72B6;&#x6001;&#x3002;&#x53EA;&#x8981;&#x786E;&#x4FDD;&#x4F60;&#x5BF9;&#x6BCF;&#x4E2A;&#x8BF7;&#x6C42;&#x8FDB;&#x884C;&#x4E86;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x8FD9;&#x6837; Shiro &#x5C06;&#x4F1A;&#x5BF9;&#x7ED9;&#x5B9A;&#x7684;&#x8BF7;&#x6C42;/&#x8C03;&#x7528;/&#x6D88;&#x606F;&#x77E5;&#x9053;&#x5B83;&#x7684; Subject &#x662F;&#x8C01;&#x3002;</p>
<p><em>Shiro&#x7684;&#x9700;&#x6C42; vs. &#x4F60;&#x7684;&#x9700;&#x6C42;</em></p>
<p><em>&#x4F7F;&#x7528; Sessions &#x4F5C;&#x4E3A;&#x5B58;&#x50A8;&#x7B56;&#x7565;&#x5C06;&#x7981;&#x7528; Shiro &#x672C;&#x8EAB;&#x7684;&#x5B9E;&#x73B0;&#x3002;&#x5B83;&#x6CA1;&#x6709;&#x5B8C;&#x5168;&#x5730;&#x7981;&#x7528; Sessions&#x3002;&#x5982;&#x679C;&#x4F60;&#x7684;&#x4EFB;&#x4F55;&#x4EE3;&#x7801;&#x663E;&#x5F0F;&#x5730;&#x8C03;&#x7528;
subject.getSession() &#x6216; subject.getSession(true) &#xFF0C;&#x4E00;&#x4E2A;session &#x4ECD;&#x7136;&#x4F1A;&#x88AB;&#x521B;&#x5EFA;&#x3002;</em></p>
<h3 id="a-hybrid-approach-&#x4E00;&#x4E2A;&#x6DF7;&#x5408;&#x7684;&#x65B9;&#x6CD5;">A Hybrid Approach &#x4E00;&#x4E2A;&#x6DF7;&#x5408;&#x7684;&#x65B9;&#x6CD5;</h3>
<p>&#x4E0A;&#x9762;&#x7684;shiro.ini &#x914D;&#x7F6E;&#x4E2D;&#x7684;(securityManager.subjectDAO.sessionStorageEvaluator.sessionStorageEnabled = false) &#x8FD9;&#x4E00;&#x884C;&#x5C06;&#x4F1A;&#x7981;&#x7528;Shiro &#x4E3A;&#x6240;&#x6709;&#x7684;Subject &#x4F7F;&#x7528;Session &#x4F5C;&#x4E3A;&#x4E00;&#x79CD;&#x5B9E;&#x73B0;&#x7B56;&#x7565;&#x3002;</p>
<p>&#x4F46;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x60F3;&#x4F7F;&#x7528;&#x6DF7;&#x5408;&#x7684;&#x65B9;&#x6CD5;&#x5462;&#xFF1F;&#x5982;&#x679C;&#x67D0;&#x4E9B;&#x5BF9;&#x8C61;&#x5E94;&#x8BE5;&#x6709;&#x4F1A;&#x8BDD;&#x800C;&#x67D0;&#x4E9B;&#x6CA1;&#x6709;&#xFF1F;&#x8FD9;&#x79CD;&#x6DF7;&#x5408;&#x6CD5;&#x65B9;&#x6CD5;&#x80FD;&#x591F;&#x7ED9;&#x8BB8;&#x591A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5E26;&#x6765;&#x597D;&#x5904;&#x3002;&#x4F8B;&#x5982;&#xFF1A;</p>
<ul>
<li>&#x4E5F;&#x8BB8; human Subject&#xFF08;&#x5982; Web &#x6D4F;&#x89C8;&#x5668;&#x7528;&#x6237;&#xFF09;&#x7531;&#x4E8E;&#x4E0A;&#x9762;&#x63D0;&#x4F9B;&#x7684;&#x597D;&#x5904;&#x80FD;&#x591F;&#x4F7F;&#x7528;Session&#x3002;</li>
<li>&#x4E5F;&#x8BB8;non-human Subject&#xFF08;&#x5982; API &#x5BA2;&#x6237;&#x7AEF;&#x6216;&#x7B2C;&#x4E09;&#x65B9;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF09;&#x4E0D;&#x5E94;&#x8BE5;&#x521B;&#x5EFA;session &#x7531;&#x4E8E;&#x5B83;&#x4EEC;&#x4E0E;&#x8F6F;&#x4EF6;&#x7684;&#x4EA4;&#x4E92;&#x53EF;&#x80FD;&#x4F1A;
&#x95F4;&#x6B47;&#x6216;&#x4E0D;&#x7A33;&#x5B9A;&#x3002;</li>
<li>&#x4E5F;&#x8BB8;&#x6240;&#x6709;&#x67D0;&#x79CD;&#x786E;&#x5B9A;&#x7C7B;&#x578B;&#x7684; Subject &#x6216;&#x4ECE;&#x67D0;&#x4E00;&#x786E;&#x5B9A;&#x4F4D;&#x7F6E;&#x8BBF;&#x95EE;&#x7CFB;&#x7EDF;&#x7684;&#x5E94;&#x8BE5;&#x5C06;&#x72B6;&#x6001;&#x4FDD;&#x6301;&#x5728;&#x4F1A;&#x8BDD;&#x4E2D;&#xFF0C;&#x4F46;&#x6240;&#x6709;&#x5176;&#x4ED6;&#x7684;&#x4E0D;&#x5E94;
&#x8BE5;&#x3002;
&#x5982;&#x679C;&#x4F60;&#x9700;&#x8981;&#x8FD9;&#x4E2A;&#x6DF7;&#x5408;&#x65B9;&#x6CD5;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A; SessionStorageEvaluator&#x3002;</li>
</ul>
<h4 id="sessionstorageevaluator">SessionStorageEvaluator</h4>
<p>&#x5728;&#x4F60;&#x60F3;&#x7A76;&#x7ADF;&#x63A7;&#x5236;&#x54EA;&#x4E2A; Subject &#x80FD;&#x591F;&#x5728;&#x5B83;&#x4EEC;&#x7684; Session &#x4E2D;&#x4FDD;&#x5B58;&#x5B83;&#x4EEC;&#x7684;&#x72B6;&#x6001;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;</p>
<p>org.apache.shiro.mgt.SessionStorageEvaluator &#x63A5;&#x53E3;&#xFF0C;&#x5E76;&#x544A;&#x8BC9;Shiro &#x54EA;&#x4E2A; Subject &#x652F;&#x6301;&#x4F1A;&#x8BDD;&#x5B58;&#x50A8;&#x3002;</p>
<p>&#x8BE5;&#x63A5;&#x53E3;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#xFF1A;</p>
<pre><code>public interface SessionStorageEvaluator {

    public boolean isSessionStorageEnabled(Subject subject);

}
</code></pre><p>&#x5173;&#x4E8E;&#x66F4;&#x8BE6;&#x7EC6;&#x7684;API &#x8BF4;&#x660E;&#xFF0C;&#x8BF7;&#x53C2;&#x89C1; SessionStorageEvaluator &#x7684;<a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/mgt/SessionStorageEvaluator.html" target="_blank">JavaDoc</a>&#x3002;
&#x4F60;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x8FD9;&#x4E00;&#x63A5;&#x53E3;&#xFF0C;&#x5E76;&#x68C0;&#x67E5; Subject&#xFF0C;&#x4E3A;&#x4E86;&#x4F60;&#x53EF;&#x80FD;&#x505A;&#x51FA;&#x8FD9;&#x4E00;&#x51B3;&#x5B9A;&#x7684;&#x4EFB;&#x4F55;&#x4FE1;&#x606F;</p>
<h5 id="subject-inspection">Subject Inspection</h5>
<p>&#x4F46;&#x5B9E;&#x73B0; isSessionStorageEnabled(subject)&#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x4E00;&#x76F4;&#x67E5;&#x770B; Subject &#x5E76;&#x8BBF;&#x95EE;&#x4EFB;&#x4F55;&#x4F60;&#x9700;&#x8981;&#x7528;&#x6765;&#x4F5C;&#x51FA;&#x51B3;&#x5B9A;&#x7684;&#x4E1C;&#x897F;&#x3002;</p>
<p>&#x5F53;&#x7136;&#x6240;&#x6709;&#x671F;&#x671B;&#x7684; Subject &#x65B9;&#x6CD5;&#x90FD;&#x662F;&#x53EF;&#x7528;&#x7684;&#xFF08;gePrincipals()&#x7B49;&#xFF09;&#xFF0C;&#x4F46;&#x7279;&#x5B9A;&#x73AF;&#x5883;&#x7684; Subject &#x5B9E;&#x4F8B;&#x4E5F;&#x662F;&#x6709;&#x4EF7;&#x503C;&#x7684;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x5728; Web &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x8BE5;&#x51B3;&#x5B9A;&#x5FC5;&#x987B;&#x57FA;&#x4E8E;&#x5F53;&#x524D; ServletRequest &#x4E2D;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x8BE5; request &#x6216;&#x8BE5; response&#xFF0C;&#x56E0;&#x4E3A;&#x8FD0;&#x884C;&#x65F6;&#x7684;Subjce &#x5B9E;&#x4F8B;&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x4E00;&#x4E2A; <a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/web/subject/WebSubject.html" target="_blank">WebSubject</a> &#x5B9E;&#x4F8B;&#xFF1A;</p>
<pre><code>...
public boolean isSessionStorageEnabled(Subject subject) {
    boolean enabled = false;
    if (WebUtils.isWeb(Subject)) {
        HttpServletRequest request = WebUtils.getHttpRequest(subject);
        //set &apos;enabled&apos; based on the current request.
    } else {
        //not a web request - maybe a RMI or daemon invocation?
        //set &apos;enabled&apos; another way...
    }

    return enabled;
}
</code></pre><p>N.B.&#x6846;&#x67B6;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x5E94;&#x8BE5;&#x8003;&#x8651;&#x5230;&#x8FD9;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x8BBF;&#x95EE;&#xFF0C;&#x5E76;&#x786E;&#x4FDD;&#x4EFB;&#x4F55;&#x8BF7;&#x6C42;/&#x8C03;&#x7528;/&#x6D88;&#x606F;&#x4E0A;&#x4E0B;&#x6587;&#x5BF9;&#x8C61;&#x53EF;&#x7528;&#x662F;&#x540C;&#x8FC7;&#x7279;&#x5B9A;&#x73AF;&#x5883;&#x4E0B;&#x7684; Subject &#x5B9E;&#x73B0;&#x7684;&#x3002;&#x8054;&#x7CFB; Shiro &#x7528;&#x6237;&#x90AE;&#x4EF6;&#x5217;&#x8868;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x60F3;&#x5E2E;&#x52A9;&#x8BBE;&#x7F6E;&#x5B83;&#xFF0C;&#x4E3A;&#x4E86;&#x4F60;&#x7684;&#x6846;&#x67B6;/&#x73AF;&#x5883;&#x3002;</p>
<h4 id="configuration-&#x914D;&#x7F6E;">Configuration &#x914D;&#x7F6E;</h4>
<p>&#x5728;&#x4F60;&#x5B9E;&#x73B0;&#x4E86; SessionStorageEvaluator &#x63A5;&#x53E3;&#x540E;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x5728; shiro.ini &#x4E2D;&#x914D;&#x7F6E;&#x5B83;&#xFF1A;</p>
<pre><code>[main]
...
sessionStorageEvaluator = com.mycompany.shiro.subject.mgt.MySessionStorageEvaluator
securityManager.subjectDAO.sessionStorageEvaluator = $sessionStorageEvaluator

...
</code></pre><h3 id="web-applications">Web Applications</h3>
<p>&#x901A;&#x5E38; Web &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5E0C;&#x671B;&#x5728;&#x6BCF;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x5BB9;&#x6613;&#x5730;&#x542F;&#x7528;&#x6216;&#x7981;&#x7528;&#x4F1A;&#x8BDD;&#x7684;&#x521B;&#x5EFA;&#xFF0C;&#x4E0D;&#x7BA1;&#x662F;&#x54EA;&#x4E2A; Subject &#x6B63;&#x5728;&#x6267;&#x884C;&#x8BF7;&#x6C42;&#x3002;&#x8FD9;&#x7ECF;&#x5E38;&#x5728;&#x652F;&#x6301; REST &#x53CA;Messaging/RMI &#x6784;&#x67B6;&#x4E0A;&#x4F7F;&#x7528;&#x6765;&#x4EA7;&#x751F;&#x5F88;&#x597D;&#x7684;&#x6548;&#x679C;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x4E5F;&#x8BB8;&#x6B63;&#x5E38;&#x7684;&#x7EC8;&#x7AEF;&#x7528;&#x6237;&#xFF08;&#x4F7F;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x4EBA;&#xFF09;&#x88AB;&#x5141;&#x8BB8;&#x521B;&#x5EFA;&#x548C;&#x4F7F;&#x7528;&#x4F1A;&#x8BDD;&#xFF0C;&#x4F46;&#x8FDC;&#x7A0B;&#x7684; API &#x5BA2;&#x6237;&#x7AEF;&#x4F7F;&#x7528;REST &#x6216; SOAP&#xFF0C;&#x4E0D;&#x8BE5;&#x62E5;&#x6709;&#x4F1A;&#x8BDD;&#xFF08;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x5728;&#x6BCF;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x4E0A;&#x9A8C;&#x8BC1;&#xFF0C;
&#x5E38;&#x89C1;&#x4E8E; REST/SOAP &#x4F53;&#x7CFB;&#x7ED3;&#x6784;&#xFF09;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x652F;&#x6301;&#x8FD9;&#x79CD; hybrid/per-request &#xFF08;&#x6DF7;&#x5408;/&#x6BCF;&#x6B21;&#x8BF7;&#x6C42;&#xFF09;&#x7684;&#x80FD;&#x529B;&#xFF0C;noSessionCreation &#x8FC7;&#x6EE4;&#x5668;&#x88AB;&#x6DFB;&#x52A0;&#x5230; Shiro &#x7684;&#x9ED8;&#x8BA4;&#x201C;&#x6C60;&#x201D;g&#x8FC7;&#x6EE4;&#x5668;&#x4E2D;&#xFF0C;&#x4E3A; Web &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x542F;&#x7528;&#x7684;&#x3002;&#x8BE5;&#x8FC7;&#x6EE4;&#x5668;&#x5C06;&#x4F1A;&#x963B;&#x6B62;&#x5728;&#x8BF7;&#x6C42;&#x671F;&#x95F4;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x4F1A;&#x8BDD;&#x6765;&#x4FDD;&#x8BC1;&#x65E0;&#x72B6;&#x6001;&#x7684;&#x4F53;&#x9A8C;&#x3002;&#x5728;shiro.ini &#x7684;[urls]&#x9879;&#x4E2D;&#xFF0C;&#x4F60;&#x901A;&#x5E38;&#x5B9A;&#x4E49;&#x8BE5;&#x8FC7;&#x6EE4;&#x5668;&#x5728;&#x6240;&#x6709;&#x5176;&#x5B83;&#x8FC7;&#x6EE4;&#x5668;&#x4E4B;&#x524D;&#x6765;&#x786E;&#x4FDD;&#x4F1A;&#x8BDD;&#x6C38;&#x8FDC;&#x4E0D;&#x4F1A;&#x88AB;&#x4F7F;&#x7528;&#x3002;</p>
<p>&#x4E3E;&#x4F8B;&#xFF1A;</p>
<pre><code>[urls]
...
/rest/** = noSessionCreation, authcBasic, ...
</code></pre><p>&#x8FD9;&#x4E2A;&#x8FC7;&#x6EE4;&#x5668;&#x5141;&#x8BB8;&#x73B0;&#x6709;&#x4F1A;&#x8BDD;&#x7684;&#x4EFB;&#x4F55;&#x4F1A;&#x8BDD;&#x64CD;&#x4F5C;&#xFF0C;&#x4F46;&#x4E0D;&#x5141;&#x8BB8;&#x5728;&#x8FC7;&#x6EE4;&#x7684;&#x8BF7;&#x6C42;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x4F1A;&#x8BDD;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5728;&#x8BF7;&#x6C42;&#x6216;&#x6CA1;&#x6709;&#x4F1A;&#x8BDD;&#x5B58;&#x5728;&#x7684;Subject &#x8C03;&#x7528;&#x4E0B;&#x9762;&#x56DB;&#x4E2A;&#x65B9;&#x6CD5;&#x4E2D;&#x7684;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x65F6;&#xFF0C;&#x5C06;&#x4F1A;&#x81EA;&#x52A8;&#x5730;&#x89E6;&#x53D1;&#x4E00;&#x4E2A; DisabledSessionException &#x5F02;&#x5E38;&#xFF1A;</p>
<ul>
<li>httpServletRequest.getSession()</li>
<li>httpServletRequest.getSession(true)</li>
<li>subject.getSession()</li>
<li>subject.getSession(true)</li>
</ul>
<p>&#x5982;&#x679C;&#x4E00;&#x4E2A; Subject &#x5728;&#x8BBF;&#x95EE; noSessionCreation-protected-URL&#xFF08;&#x65E0;&#x4F1A;&#x8BDD;&#x521B;&#x5EFA;&#x4FDD;&#x62A4;&#x7684; URL&#xFF09; &#x4E4B;&#x524D;&#x5DF2;&#x7ECF;&#x6709;&#x4E00;&#x4E2A;&#x4F1A;&#x8BDD;&#xFF0C;&#x5219;&#x4E0A;&#x8FF0;&#x7684;&#x56DB;&#x79CD;&#x8C03;&#x7528;&#x4ECD;&#x7136;&#x4F1A;&#x5982;&#x9884;&#x671F;&#x5DE5;&#x4F5C;&#x3002;</p>
<p>&#x6700;&#x540E;&#xFF0C;&#x5728;&#x6240;&#x6709;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E0B;&#x9762;&#x7684;&#x8C03;&#x7528;&#x5C06;&#x59CB;&#x7EC8;&#x88AB;&#x5141;&#x8BB8;&#xFF1A;</p>
<ul>
<li>httpServletRequest.getSession(false)</li>
<li>subject.getSession(false)</li>
</ul>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../II. Core 核心/7. Realms.html" class="navigation navigation-prev " aria-label="Previous page: 7. Realms"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../II. Core 核心/9. Cryptography 密码.html" class="navigation navigation-next " aria-label="Next page: 9. Cryptography 密码"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
